<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://github.com/111zx/111zx.github.io/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="zx">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/111zx/111zx.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/spring/" class="article-date">
  <time datetime="2020-05-20T03:10:36.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/spring/">spring</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul>
<li>给软件行业带来了春天</li>
<li>Spring时一个轻量级控制反转和面向切面的容器框架</li>
<li>目的：降低复杂性</li>
</ul>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><ul>
<li><p>2002 ，首次推出了Spring框架的雏形：interface21</p>
</li>
<li><p>2004，3月24号正式发布了1.0版本</p>
</li>
<li><p>Rod Johnson 是Spring框架创始人，是一位音乐博士人，“不要重复造轮子”</p>
</li>
<li><p>设计哲学</p>
<ul>
<li>代码质量非常高</li>
<li>降低复杂性</li>
<li>大杂烩，整合了现有的技术框架</li>
</ul>
</li>
<li><p>官网：</p>
</li>
<li><p>官方下载地址：<a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">https://repo.spring.io/release/org/springframework/spring/</a></p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p>Spring是一个开源的免费的框架</p>
</li>
<li><p>Spring是一个<strong>轻量级</strong>的，非入侵式的框架</p>
</li>
<li><p><strong>控制反转(IOC)</strong>，<strong>面向切面编程（AOP</strong>）</p>
</li>
<li><p>支持事务的处理，对框架整合的支持</p>
</li>
</ul>
<h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><p><img src="/111zx/111zx.github.io/2020/05/20/spring/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5CSpring%5CSpring%E6%A8%A1%E5%9D%97.jpg" alt></p>
<h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><ul>
<li>Spring boot<ul>
<li>一个快速开发的脚手架</li>
<li>基于SpringBoot可以快速的开发单个微服务</li>
<li>约定大于配置</li>
</ul>
</li>
<li>Spring Cloud<ul>
<li>SpringCloud是基于SpringSboot实现的</li>
</ul>
</li>
<li>大多数公司都在使用SpringBoot开发，学习SpringBoot的前提，需要完全掌握Spring以及SpringMVC!承上启下的作用。</li>
</ul>
<ul>
<li>Spring弊端：发展太久，违背了原有的理念，配置十分繁琐，人称：”配置地域！“。</li>
</ul>
<h1 id="IOC理论推导"><a href="#IOC理论推导" class="headerlink" title="IOC理论推导"></a>IOC理论推导</h1><ol>
<li><h1 id="03-7：54"><a href="#03-7：54" class="headerlink" title="03   7：54"></a>03   7：54</h1></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/spring/" data-id="ckbbzdvsi0009t8ubh5fldhc8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/redis/" class="article-date">
  <time datetime="2020-05-20T02:10:40.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/redis/">redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="NoSql入门和概述"><a href="#NoSql入门和概述" class="headerlink" title="NoSql入门和概述"></a>NoSql入门和概述</h1><h2 id="入门概述"><a href="#入门概述" class="headerlink" title="入门概述"></a>入门概述</h2><ol>
<li>互联网背景下的机遇，为什么用NoSql<ul>
<li>数据量到达一定程度的时候速度会变得非常慢（500w是Mysql的一个限度）</li>
<li>缓存技术+垂直分布</li>
<li>Mysql主从读写分离<ul>
<li>写的操作在主库</li>
<li>读的操作在从库</li>
</ul>
</li>
<li>分表分库+水平拆分+mysql集群<ul>
<li>常用的在一个库，不常用的在另一个；分多个库查询快</li>
<li>集群分开查询速度快</li>
</ul>
</li>
<li>扩展性瓶颈，存储不了大的内容</li>
<li>使用NoSql原因总结：由于数据的爆炸增长，传统的关系型数据库不能支持业务</li>
</ul>
</li>
<li>是什么<ul>
<li>不仅仅是SQL，Not Only Sql</li>
<li>NoSql数据不需要固定的模式，无需多于操作就可以横向扩展</li>
</ul>
</li>
<li>能干什么<ul>
<li>易扩展：去掉关系型数据库的关系型特性，数据之间没有关系，非常容易扩展</li>
<li>高性能：读写性能非常优秀（1s读16w写8w）</li>
<li>灵活的数据模型：存储自定义数据格式无需事先建立字段。</li>
</ul>
</li>
<li>去哪下<ul>
<li>Redis：功能丰富时优秀</li>
<li>Memcache：单一的功能速度快</li>
<li>Mongdb：功能丰富时优秀</li>
</ul>
</li>
<li>怎么玩<ul>
<li>KV</li>
<li>Cache</li>
<li>Persistence</li>
<li>……</li>
</ul>
</li>
</ol>
<h2 id="3V-3高"><a href="#3V-3高" class="headerlink" title="3V + 3高"></a>3V + 3高</h2><h3 id="大数据时代的3V"><a href="#大数据时代的3V" class="headerlink" title="大数据时代的3V"></a>大数据时代的3V</h3><ol>
<li>海量Volume<ul>
<li>双11天猫</li>
</ul>
</li>
<li>多样Variety<ul>
<li>数据多余</li>
</ul>
</li>
<li>实时Velocity<ul>
<li>订票的实时更新</li>
</ul>
</li>
</ol>
<h3 id="互联网需求的三高"><a href="#互联网需求的三高" class="headerlink" title="互联网需求的三高"></a>互联网需求的三高</h3><ol>
<li>高并发<ul>
<li>挖红包，挖数据</li>
</ul>
</li>
<li>高可扩<ul>
<li>横向扩展（纵向扩展有极限）</li>
</ul>
</li>
<li>高性能<ul>
<li>单点故障，容灾备份</li>
</ul>
</li>
</ol>
<h2 id="NoSQL-的经典应用"><a href="#NoSQL-的经典应用" class="headerlink" title="NoSQL 的经典应用"></a>NoSQL 的经典应用</h2><ul>
<li><p>当下的应用是sql和nosql一起使用</p>
</li>
<li><p>阿里巴巴中文网站架构发展</p>
<ul>
<li>1999第一代架构网站：Perl，CGI，Oracle</li>
<li>2000进入JAVA时代：JAVA,servlet</li>
<li>2004EJB时代：EJB</li>
<li>Without EJB重构：去EJB重构</li>
<li>海量数据：Hadoop，KV</li>
<li>2010安全镜像</li>
</ul>
</li>
<li><p>多数据源多数据类型的存储问题</p>
</li>
<li><p>视频，大的图片 </p>
</li>
<li><p>商品基本信息：去IOE化,MYSQL</p>
</li>
<li><p>商品描述，详情，评价信息：文档数据库MongDB</p>
</li>
<li><p>商品图片：分布式的文件系统淘宝的TFS，Google的GFS，Hadoop的HDFS</p>
</li>
<li><p>商品的关键字：Isearch，淘宝内用搜索引擎</p>
</li>
<li><p>商品波段性的热点高频信息：内存数据库Tair，Redis，Memache</p>
</li>
<li><p>商品的交易，价格计算，积分积累：外部系统，支付宝</p>
</li>
<li><p>总结大型互联网应用（大数据，高并发，多样数据类型）的难点和解决方案</p>
<ul>
<li>难点<ul>
<li>数据类型多样性</li>
<li>数据源多样性和变化重构</li>
<li>数据源改造而数据服务平台不需要大面积重构</li>
</ul>
</li>
<li>解决方案<ul>
<li>EAI和统一数据平台服务层</li>
<li>UDSL（阿里）统一数据平台服务层<ul>
<li>映射，API,热点缓存</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="NoSQL模型"><a href="#NoSQL模型" class="headerlink" title="NoSQL模型"></a>NoSQL模型</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/redis/" data-id="ckbbzdvsg0008t8ubhn6257wt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据结构" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="article-date">
  <time datetime="2020-05-19T23:49:59.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="第一章-数组"><a href="#第一章-数组" class="headerlink" title="第一章 数组"></a>第一章 数组</h1><h2 id="稀疏数组"><a href="#稀疏数组" class="headerlink" title="稀疏数组"></a>稀疏数组</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpareArray</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;ArrayList&gt; <span class="title">ToSimple</span><span class="params">(<span class="keyword">int</span>[][] Arr)</span></span>&#123;</span><br><span class="line">        List&lt;ArrayList&gt; list = <span class="keyword">new</span> ArrayList&lt;ArrayList&gt;();</span><br><span class="line">        ArrayList list1 = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Arr[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(Arr[i][j] != <span class="number">0</span>)&#123;</span><br><span class="line">                    list1.add(i);</span><br><span class="line">                    list1.add(j);</span><br><span class="line">                    list1.add(Arr[i][j]);</span><br><span class="line">                    list.add(list1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> chessArr1[][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">11</span>][<span class="number">11</span>];</span><br><span class="line">        chessArr1[<span class="number">2</span>][<span class="number">5</span>] = <span class="number">5</span>;</span><br><span class="line">        chessArr1[<span class="number">2</span>][<span class="number">8</span>] = <span class="number">15</span>;</span><br><span class="line">        chessArr1[<span class="number">7</span>][<span class="number">5</span>] = <span class="number">25</span>;</span><br><span class="line">        chessArr1[<span class="number">4</span>][<span class="number">5</span>] = <span class="number">35</span>;</span><br><span class="line">        Iterator itertor = ToSimple(chessArr1).iterator();</span><br><span class="line">        <span class="keyword">while</span>(itertor.hasNext())&#123;</span><br><span class="line">            System.out.println(itertor.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><h3 id="单向队列"><a href="#单向队列" class="headerlink" title="单向队列"></a>单向队列</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayQ</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rear;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] arr;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQ</span><span class="params">(<span class="keyword">int</span> arrMaxSize)</span></span>&#123;</span><br><span class="line">        maxSize = arrMaxSize;</span><br><span class="line">        arr = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">        front = -<span class="number">1</span>;<span class="comment">//指向队列头的前一个位置</span></span><br><span class="line">        rear = -<span class="number">1</span>;<span class="comment">//指向队列尾部的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.rear == maxSize - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.rear == <span class="keyword">this</span>.front;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNum</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isFull())&#123;</span><br><span class="line">            System.out.println(<span class="string">"Queue is FULL!"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            rear++;</span><br><span class="line">            arr[rear] = num;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        front++;</span><br><span class="line">        <span class="keyword">return</span> arr[front];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = front + <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">           System.out.println(arr[i]);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">headQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">return</span> arr[front + <span class="number">1</span>];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="环形队列"><a href="#环形队列" class="headerlink" title="环形队列"></a>环形队列</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayQ</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> rear;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] arr;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQ</span><span class="params">(<span class="keyword">int</span> arrMaxSize)</span></span>&#123;</span><br><span class="line">        maxSize = arrMaxSize;</span><br><span class="line">        arr = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">        front = <span class="number">0</span>;<span class="comment">//指向队列头的数据</span></span><br><span class="line">        rear = <span class="number">0</span>;<span class="comment">//指向队列尾部的后一个数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rear - maxSize &gt;= front;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.rear == <span class="keyword">this</span>.front;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNum</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isFull())&#123;</span><br><span class="line">            System.out.println(<span class="string">"Queue is FULL!"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            arr[rear % maxSize] = num;</span><br><span class="line">            rear ++;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[front % maxSize];</span><br><span class="line">        front ++;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (rear - front); j++) &#123;</span><br><span class="line">           System.out.print(arr[(j + front) % maxSize]+ <span class="string">" "</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">headQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Queue is Empty!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">return</span> arr[front % maxSize];</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="第二章-链表"><a href="#第二章-链表" class="headerlink" title="第二章 链表"></a>第二章 链表</h1><h2 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li>链表是以节点的方式存储，每个节点必须包含data域，next域：指向下一个节点</li>
<li>节点不一定是连续的</li>
<li>链表分为有头节点和没有头节点<ul>
<li><strong>头节点不需要考虑链表为空</strong></li>
</ul>
</li>
<li>案例<ul>
<li>好友列表从服务器返回客户端需要按序返回（显示好友状态）</li>
</ul>
</li>
</ul>
<h3 id="头节点作用"><a href="#头节点作用" class="headerlink" title="头节点作用"></a>头节点作用</h3><ul>
<li>不存放数据</li>
<li>表示单链表头部，有next域，指向第一个有数据的节点</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有头节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Linklist</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        HeroNode hero1 = <span class="keyword">new</span> HeroNode(<span class="number">1</span>,<span class="string">"松江1"</span>,<span class="string">"及时雨"</span>);</span><br><span class="line">        HeroNode hero2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>,<span class="string">"松江2"</span>,<span class="string">"及时雨"</span>);</span><br><span class="line">        HeroNode hero3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>,<span class="string">"松江3"</span>,<span class="string">"及时雨"</span>);</span><br><span class="line">        HeroNode hero4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>,<span class="string">"松江4"</span>,<span class="string">"及时雨"</span>);</span><br><span class="line">        SingleLinkedList list = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line">        list.add(hero1);</span><br><span class="line">        list.add(hero4);</span><br><span class="line">        list.add(hero2);</span><br><span class="line">        list.add(hero3);</span><br><span class="line">        list.showList();</span><br><span class="line">        list.remove(hero3);</span><br><span class="line">        list.showList();</span><br><span class="line">        list.addindex(hero3, <span class="number">2</span>);</span><br><span class="line">        list.showList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义SingleLinkedList 管理我们的HeroNode</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HeroNode head = <span class="keyword">new</span> HeroNode(<span class="number">0</span>,<span class="string">""</span>,<span class="string">""</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HeroNode hexonode)</span></span>&#123;</span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        temp.next = hexonode;</span><br><span class="line">        hexonode.next = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addindex</span><span class="params">(HeroNode hexonode,<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            index--;</span><br><span class="line">        &#125;</span><br><span class="line">        HeroNode temp1 = temp.next;</span><br><span class="line">        temp.next = hexonode;</span><br><span class="line">        hexonode.next = temp1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(HeroNode heronode)</span></span>&#123;</span><br><span class="line">        HeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.next.no != heronode.no)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        temp.next = heronode.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> no;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String nickname;</span><br><span class="line">    <span class="keyword">public</span> HeroNode next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> no, String name, String nickname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.no = no;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"HeroNode&#123;"</span> +</span><br><span class="line">                <span class="string">"no="</span> + no +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", nickname='"</span> + nickname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", next="</span> + next +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="双链表"><a href="#双链表" class="headerlink" title="双链表"></a>双链表</h2><ul>
<li><strong>自我删除</strong></li>
<li><strong>一定不能插入两个相同的节点为相邻，否则会出现死循环，栈溢出</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无头节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">prenextlistTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        prenextHeroNode hero1 = <span class="keyword">new</span> prenextHeroNode(<span class="number">1</span>,<span class="string">"松江1"</span>,<span class="string">"及时雨1"</span>);</span><br><span class="line">        prenextHeroNode hero2 = <span class="keyword">new</span> prenextHeroNode(<span class="number">2</span>,<span class="string">"松江2"</span>,<span class="string">"及时雨2"</span>);</span><br><span class="line">        prenextHeroNode hero3 = <span class="keyword">new</span> prenextHeroNode(<span class="number">3</span>,<span class="string">"松江3"</span>,<span class="string">"及时雨3"</span>);</span><br><span class="line">        prenextHeroNode hero4 = <span class="keyword">new</span> prenextHeroNode(<span class="number">4</span>,<span class="string">"松江4"</span>,<span class="string">"及时雨4"</span>);</span><br><span class="line">        SingleLinkedprenextList list = <span class="keyword">new</span> SingleLinkedprenextList();</span><br><span class="line">        list.add(hero1);</span><br><span class="line">        list.add(hero2);</span><br><span class="line">        list.add(hero3);</span><br><span class="line">        list.add(hero4);</span><br><span class="line">        list.showList();</span><br><span class="line">        list.remove(hero2);</span><br><span class="line">        list.showList();</span><br><span class="line">        list.addindex(hero2, <span class="number">2</span>);<span class="comment">//一定不能插入两个相同的节点为相邻，否则会出现死循环，栈溢出</span></span><br><span class="line">        list.showList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedprenextList</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> prenextHeroNode head = <span class="keyword">new</span> prenextHeroNode(<span class="number">0</span>,<span class="string">""</span>,<span class="string">""</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(prenextHeroNode hexonode)</span></span>&#123;</span><br><span class="line">        prenextHeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        temp.next = hexonode;</span><br><span class="line">        hexonode.pre = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addindex</span><span class="params">(prenextHeroNode hexonode,<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        prenextHeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            index--;</span><br><span class="line">        &#125;</span><br><span class="line">        hexonode.pre = temp;</span><br><span class="line">        hexonode.next = temp.next;</span><br><span class="line">        hexonode.next.pre = hexonode;</span><br><span class="line">        temp.next = hexonode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        prenextHeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(prenextHeroNode heronode)</span></span>&#123;</span><br><span class="line">        prenextHeroNode temp = head;</span><br><span class="line">        <span class="keyword">while</span>(temp.no != heronode.no)&#123;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        temp.next.pre = temp.pre;</span><br><span class="line">        temp.pre.next = temp.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">prenextHeroNode</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> no;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String nickname;</span><br><span class="line">    <span class="keyword">public</span> prenextHeroNode next;</span><br><span class="line">    <span class="keyword">public</span> prenextHeroNode pre;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">prenextHeroNode</span><span class="params">(<span class="keyword">int</span> no, String name, String nickname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.no = no;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"prenextHeroNode&#123;"</span> +</span><br><span class="line">                <span class="string">"no="</span> + no +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", nickname='"</span> + nickname + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", next="</span> + next +</span><br><span class="line"><span class="comment">//                ", pre=" + pre +</span></span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="环形链表"><a href="#环形链表" class="headerlink" title="环形链表"></a>环形链表</h2><h3 id="约瑟夫"><a href="#约瑟夫" class="headerlink" title="约瑟夫"></a>约瑟夫</h3><h1 id="第三章-栈"><a href="#第三章-栈" class="headerlink" title="第三章 栈"></a>第三章 栈</h1><h2 id="数组模拟栈"><a href="#数组模拟栈" class="headerlink" title="数组模拟栈"></a>数组模拟栈</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] stack;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> top = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ArrayStack&#123;"</span> +</span><br><span class="line">                <span class="string">"stack="</span> + Arrays.toString(stack) +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">        stack = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> top == maxSize - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Stack is Full !"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            top++;</span><br><span class="line">            stack[top] = num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">gettop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stack[top];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showStack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; top; i++) &#123;</span><br><span class="line">            System.out.print(stack[i] + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Stack is Empty !"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> stack[top--];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逆波兰计算器"><a href="#逆波兰计算器" class="headerlink" title="逆波兰计算器"></a>逆波兰计算器</h2><h1 id="第四章-排序"><a href="#第四章-排序" class="headerlink" title="第四章 排序"></a>第四章 排序</h1><h2 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h2><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><h2 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h2><h2 id="归并"><a href="#归并" class="headerlink" title="归并"></a>归并</h2><h2 id="快速"><a href="#快速" class="headerlink" title="快速"></a>快速</h2><h2 id="堆排"><a href="#堆排" class="headerlink" title="堆排"></a>堆排</h2><h2 id="基数"><a href="#基数" class="headerlink" title="基数"></a>基数</h2><h2 id="桶排"><a href="#桶排" class="headerlink" title="桶排"></a>桶排</h2><h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><h1 id="第五章-查找"><a href="#第五章-查找" class="headerlink" title="第五章 查找"></a>第五章 查找</h1><h2 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h2><ul>
<li><p>必须在有序数组中进行查找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">erfenFind</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayList list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList <span class="title">impmethod</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> high = arr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(arr[low] &gt; num || arr[high] &lt; num)&#123;</span><br><span class="line">            list.add(-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i = method(arr, low, (low + high) / <span class="number">2</span>, high, num);</span><br><span class="line">        <span class="keyword">if</span>(i == -<span class="number">1</span>) &#123;</span><br><span class="line">            list.clear();</span><br><span class="line">            list.add(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">method</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> low, <span class="keyword">int</span> mid, <span class="keyword">int</span> high, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(low &gt; high )&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] == num) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mid; i &lt; high - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[i] == arr [i+<span class="number">1</span>])&#123;</span><br><span class="line">                    list.add(i+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(mid);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mid; i &gt; <span class="number">1</span> ; i--) &#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[i] == arr [i-<span class="number">1</span>])&#123;</span><br><span class="line">                    list.add(i-<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &gt; num) &#123;</span><br><span class="line">            <span class="keyword">return</span> method(arr, low, (low + mid) / <span class="number">2</span>, mid, num);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> method(arr, mid + <span class="number">1</span>, (high + mid + <span class="number">1</span>) / <span class="number">2</span>, high, num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">55</span>,<span class="number">441</span>,<span class="number">441</span>,<span class="number">441</span>,<span class="number">9999</span>&#125;;</span><br><span class="line">        System.out.println(impmethod(arr, <span class="number">441</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="插值查找"><a href="#插值查找" class="headerlink" title="插值查找"></a>插值查找</h2><ul>
<li>只改变了二分查找mid的值</li>
<li><strong>在查找的值超出数组范围过大时，可能会报错，要考虑进去</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid = left + (high - low) * (num - left) / (right - left)</span><br></pre></td></tr></table></figure>

<h2 id="斐波那契查找"><a href="#斐波那契查找" class="headerlink" title="斐波那契查找"></a>斐波那契查找</h2><h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><h1 id="第六章-树"><a href="#第六章-树" class="headerlink" title="第六章 树"></a>第六章 树</h1><h2 id="树的概述"><a href="#树的概述" class="headerlink" title="树的概述"></a>树的概述</h2><h3 id="1-为什么需要树"><a href="#1-为什么需要树" class="headerlink" title="1. 为什么需要树"></a>1. 为什么需要树</h3><ul>
<li>数组数据结构<ul>
<li>优点：<strong>通过下标访问</strong>元素，速度快。对于<strong>有序数组</strong>，用二分查找速度快</li>
<li>缺点：如果检索具体某个值，或者插入某个值，会<strong>整体移动，效率低</strong>。如果需要<strong>扩容</strong>，会创建新的数组，并且需要<strong>拷贝</strong>到新的数组。</li>
</ul>
</li>
<li>链表<ul>
<li>优点：在一定程度上对数组存储方式有优化，插入和删除节点时不需要整体移动。</li>
<li>缺点：在进行检索时，效率任然很低，需要挨个遍历。</li>
</ul>
</li>
<li>树<ul>
<li>提高了存储和读取的效率。</li>
</ul>
</li>
</ul>
<h3 id="2-常用术语"><a href="#2-常用术语" class="headerlink" title="2. 常用术语"></a>2. 常用术语</h3><ul>
<li>节点</li>
<li>根节点</li>
<li>父节点</li>
<li>子节点</li>
<li>叶子节点</li>
<li>节点的权</li>
<li>路径<ul>
<li>从<strong>根节点</strong>到该节点的路线</li>
</ul>
</li>
<li>层<ul>
<li><strong>根节点</strong>是<strong>第一层</strong>，往后依次递增</li>
</ul>
</li>
<li>子树</li>
<li>树的高度<ul>
<li>最高的层数</li>
</ul>
</li>
<li>森林<ul>
<li>多颗子树构成森林</li>
</ul>
</li>
</ul>
<h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>每个节点<strong>最多只有两个</strong>节点，分别为左节点和右节点</li>
<li>如果该二叉树所有的叶子节点都在最后一层，并且节点总数为 2^n - 1，n为层数，我们称之为满二叉树</li>
<li>完全二叉树:所有叶子节点都在<strong>最后一层或者倒数第二层</strong>，<strong>最后一层的叶子节点在左边连续，倒数第二层叶子节点在右边连续</strong></li>
</ul>
<h3 id="前中后序遍历"><a href="#前中后序遍历" class="headerlink" title="前中后序遍历"></a>前中后序遍历</h3><h3 id="插入节点"><a href="#插入节点" class="headerlink" title="插入节点"></a>插入节点</h3><h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><h2 id="线索化二叉树"><a href="#线索化二叉树" class="headerlink" title="线索化二叉树"></a>线索化二叉树</h2><h2 id="Huffman树"><a href="#Huffman树" class="headerlink" title="Huffman树"></a>Huffman树</h2><h2 id="二叉排序树"><a href="#二叉排序树" class="headerlink" title="二叉排序树"></a>二叉排序树</h2><h2 id="平衡二叉树"><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h2><h2 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h2><h1 id="第七章-图"><a href="#第七章-图" class="headerlink" title="第七章 图"></a>第七章 图</h1><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><h2 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" data-id="ckbbzdvsz000it8ub4wc8844m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2020-05-19T23:48:30.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="设计模式的应用场景"><a href="#设计模式的应用场景" class="headerlink" title="设计模式的应用场景"></a>设计模式的应用场景</h2><ul>
<li><p>设计模式是对软件设计中普遍存在的问题，提出的解决方案。</p>
</li>
<li><p>设计模式可以将软件规范化，易于理解，增强复用性，维护性</p>
</li>
<li><p>面向对象=&gt;功能模块（设计模式+算法）=&gt;框架（多种设计模式）=&gt;架构（服务器集群）</p>
</li>
</ul>
<h2 id="设计模式七大原则"><a href="#设计模式七大原则" class="headerlink" title="设计模式七大原则"></a>设计模式七大原则</h2><h3 id="设计模式的目的"><a href="#设计模式的目的" class="headerlink" title="设计模式的目的"></a>设计模式的目的</h3><ul>
<li>代码重用性</li>
<li>可读性</li>
<li>可扩展性</li>
<li>可靠性</li>
<li>高内聚（模块内凝聚）低耦合（不同模块之间依赖性小）</li>
</ul>
<h3 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h3><ul>
<li><p><strong>一个类应该只负责一项职责</strong>（不是只有一個方法，是一項職責（訂單的類不要去操作員工的職責））；如果一个类负责两个不同职责，职责1改变，导致职责二执行错误。</p>
</li>
<li><p>职责也可以用类里面的方法分解。（类的结构简单的情况下）</p>
</li>
<li><p>特点</p>
<ul>
<li>降低类的复杂性</li>
<li>提高可读性，可维护性</li>
<li>降低变更引起的可能性</li>
<li>只有类的结构很简单，方法足够少时，才能根据方法进行单一职责分解。</li>
</ul>
</li>
<li><p>用類來化解if else分支</p>
</li>
</ul>
<h3 id="接口隔离原則"><a href="#接口隔离原則" class="headerlink" title="接口隔离原則"></a>接口隔离原則</h3><ul>
<li>客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//B实现了A接口，C依赖于B接口，但只依赖method1，其他的方法都成了冗余代码，可以重新设置接口以减少冗余</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	method1();</span><br><span class="line">    method2();</span><br><span class="line">    method3();</span><br><span class="line">    method4();</span><br><span class="line">    method5();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="title">implement</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">(B b)</span></span>&#123;</span><br><span class="line">       	b.metnod1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>拆分接口，各取所需</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A1</span></span>&#123;</span><br><span class="line">	method1();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A2</span></span>&#123;</span><br><span class="line">    method2();</span><br><span class="line">    method3();</span><br><span class="line">    method4();</span><br><span class="line">    method5();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="title">implement</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sout(B method1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">(B b)</span></span>&#123;</span><br><span class="line">       	b.metnod1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="依赖倒转原则"><a href="#依赖倒转原则" class="headerlink" title="依赖倒转原则"></a>依赖倒转原则</h3><h4 id="关注点"><a href="#关注点" class="headerlink" title="关注点"></a>关注点</h4><ul>
<li>高层模块不应该依赖底层模块，二者都应该依赖其抽象</li>
<li><strong>抽象不应该依赖细节，细节应该依赖抽象</strong></li>
<li>依赖倒转的中心思想是<strong>面向接口</strong>编程</li>
<li>相对于细节的多变性，抽象的东西要<strong>稳定</strong>的多。一抽象为基础搭建的架构比以戏界为基础的架构要稳得多。在java中，抽象指的是接口或者抽象类，细节就是具体的实现类。</li>
<li>在接口不抽象类里面<strong>不要有具体的操作</strong></li>
</ul>
<h4 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示"></a>实例演示</h4><ul>
<li>传统方式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Person 接收消息的功能 传统方式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Email email)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        email.getInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        retutn <span class="string">"hello !"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 简单，易于实现</span></span><br><span class="line"><span class="comment">2.如果我们获取的对象是微信，短信等，需要新增类，而且Persion需要新增方法</span></span><br><span class="line"><span class="comment">3.解决思路：引入一个接口IReceiver，表示接收者，这样Persion类和接口IReceive发生依赖</span></span><br><span class="line"><span class="comment">4.设计IReceive接口，可以用微信，邮件，短信等类去是实现接口，这样就符合依赖倒转原则</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">psvm&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.receive(<span class="keyword">new</span> Email());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>依赖倒转原则实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Depend</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IReceive</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getinfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">weixin</span> <span class="keyword">implements</span> <span class="title">IReceive</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getinfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"微信"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="keyword">implements</span> <span class="title">IReceive</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getinfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"email"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(IReceive receive)</span></span>&#123;</span><br><span class="line">        receive.getinfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3种方式实现传递依赖"><a href="#3种方式实现传递依赖" class="headerlink" title="3种方式实现传递依赖"></a>3种方式实现传递依赖</h4><ol>
<li><p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(ITV tv)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCL</span> <span class="keyword">implements</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TCL open!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(ITV tv)</span> </span>&#123;</span><br><span class="line">        tv.play();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCL</span> <span class="keyword">implements</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TCL open!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ITV tv;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OpenAndClose</span><span class="params">(ITV tv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tv.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>sellter传递</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过set方法实现依赖传递</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOpenAndClose</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTv</span><span class="params">(ITV tv)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCL</span> <span class="keyword">implements</span> <span class="title">ITV</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TCL open!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpenAndClose</span> <span class="keyword">implements</span> <span class="title">IOpenAndClose</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ITV tv;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tv.play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTv</span><span class="params">(ITV tv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>一层模块尽量都要有抽象类或接口，或者两者都有，程序稳定性更好</li>
<li>在声明对象的时候<strong>最好使用接口或者抽象类</strong>，这样在变量引用和实际对象之间会有一个缓冲层，有利于程序扩展和优化<ul>
<li>在类继承多个接口时，使用接口定义引用变量类型可以清楚了解这个变量的含义</li>
<li>想换一种实现类的构造器来实现功能时，只需要修改构造器的名字</li>
<li><strong>如果类内实现了接口没有的方法，那么不能使用接口定义变量</strong></li>
</ul>
</li>
<li>继承时遵循里氏替换原则</li>
</ol>
<h3 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><ul>
<li>继承性的劣势<ul>
<li>对象间的耦合性：如果父类需要改变，那么子类的方法可能需要大面积修改</li>
</ul>
</li>
<li>原则基本介绍<ul>
<li>尽量不要去重写父类的方法</li>
<li>如果有必须的功能要求，可以通过聚合，组合，依赖来解决，降低耦合性。可以将<strong>基类</strong>的方法<strong>优化到最简</strong>，可以<strong>降低耦合性</strong>。</li>
</ul>
</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><ul>
<li><p>耦合性高的代码（不好）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//本来以为是运行的A类的方法，但是没有注意到B类的方法和A类的方法名相同，发生了错误</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决办法：让B和A继承一个更加简单的基类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据组合实现的耦合性低的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">base</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决办法：让B和A继承一个更加简单的基类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">base</span></span>&#123;</span><br><span class="line">    <span class="comment">//如果B类需要使用A类的方法，使用组合关系</span></span><br><span class="line">    <span class="keyword">private</span> A a = <span class="keyword">new</span> A();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func3</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.a.func1(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h4><ul>
<li>尽量不要重写父类（会被调用到）的方法</li>
<li><strong>所有引用基类的地方必须能够透明地使用子类地对象</strong></li>
</ul>
<h4 id="引申"><a href="#引申" class="headerlink" title="引申"></a>引申</h4><ul>
<li>用哪个类地构造方法实例化，和父类同名地方法就追溯到这个类地方法为止，使用年轻的一个方法。</li>
<li>静态代码块在构造方法之前执行，类加载的准备阶段。</li>
</ul>
<h3 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h3><h4 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h4><ul>
<li>最基础，最重要的设计原则</li>
<li><strong>对提供方开放，对使用方关闭</strong></li>
<li><strong>模块和函数应该对扩展开放，对修改关闭。用抽象构建框架，用实现扩展细节。</strong></li>
<li>当软件需要变化时，尽量通过扩展软件实体的行为来实现变化，而不是通过修改已有的代码来实现变化</li>
<li>使用设计模式的目的就是遵循开闭原则</li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><h5 id="错误案例"><a href="#错误案例" class="headerlink" title="错误案例"></a>错误案例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">优点：简单好理解</span></span><br><span class="line"><span class="comment">缺点：违反了OCP原则，对扩展开放，对修改关闭。主要是drawShape方法</span></span><br><span class="line"><span class="comment">当增加一个绘制三角形的方法时，需要改变drawShape方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Shape s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.m_type == <span class="number">1</span>)&#123;</span><br><span class="line">            drawRectangle(s);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.m_type == <span class="number">2</span>)&#123;</span><br><span class="line">            drawCircle(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRectangle</span><span class="params">(Shape r)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"矩形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(Shape c)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"圆形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m_type;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    Rectangle()&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    Circle()&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="正确案例"><a href="#正确案例" class="headerlink" title="正确案例"></a>正确案例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">让使用方尽量得简单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Shape s)</span></span>&#123;</span><br><span class="line">        s.draw();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span>  <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m_type;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    Rectangle()&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"矩形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    Circle()&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"圆形"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="迪米特法则（最少知道原则）"><a href="#迪米特法则（最少知道原则）" class="headerlink" title="迪米特法则（最少知道原则）"></a>迪米特法则（最少知道原则）</h3><h4 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h4><ul>
<li><p><strong>在别人的类里不要有自己类的业务逻辑，只提供完成业务逻辑的方法的接口。</strong></p>
</li>
<li><p>一个对象应该对其它对象保持最少的了解</p>
</li>
<li><p>类与类的关系越密切，耦合度越大</p>
</li>
<li><p>一个类对子依赖的类知道的越少越好。对于被以来的类不管多麽复杂，都精良讲逻辑封装在类的内部。对外除了提供的public方法，不对外泄露任何信息。</p>
</li>
<li><p>耦合的方式</p>
<ul>
<li>依赖</li>
<li>关联</li>
<li>组合</li>
<li>聚合</li>
</ul>
</li>
<li><p>一个类在另一个类中作为<strong>成员变量，方法参数，方法返回值</strong>中的类为直接朋友</p>
</li>
<li><p>出现在<strong>局部变量中的类不是直接朋友</strong>，例如在方法中new出来的类</p>
</li>
<li><p>降低耦合，并不是消除耦合</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> 迪米特;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">school 可以对 teacher 直接操作</span></span><br><span class="line"><span class="comment">teacher 可以对 student 直接操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demeterTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        student stu1 = <span class="keyword">new</span> student(<span class="string">"stu1"</span>);</span><br><span class="line">        student stu2 = <span class="keyword">new</span> student(<span class="string">"stu2"</span>);</span><br><span class="line">        student stu3 = <span class="keyword">new</span> student(<span class="string">"stu3"</span>);</span><br><span class="line">        student stu4 = <span class="keyword">new</span> student(<span class="string">"stu4"</span>);</span><br><span class="line">        teacher tea1 = <span class="keyword">new</span> teacher(<span class="string">"tea1"</span>);</span><br><span class="line">        teacher tea2 = <span class="keyword">new</span> teacher(<span class="string">"tea2"</span>);</span><br><span class="line">        tea1.addstu(stu1);</span><br><span class="line">        tea1.addstu(stu2);</span><br><span class="line">        tea1.addstu(stu3);</span><br><span class="line">        tea1.addstu(stu4);</span><br><span class="line">        school sch = <span class="keyword">new</span> school();</span><br><span class="line">        sch.addtea(tea1);</span><br><span class="line">        sch.addtea(tea2);</span><br><span class="line">        sch.showAllMember();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;student&gt; stulist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">teacher</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addstu</span><span class="params">(student stu)</span> </span>&#123;</span><br><span class="line">        stulist.add(stu);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;student&gt; <span class="title">getAllStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stulist;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showstudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (student stu : stulist) &#123;</span><br><span class="line">            System.out.println(stu.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> ArrayList&lt;teacher&gt; tealist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showAllMember</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"-------教师信息---------"</span>);</span><br><span class="line">            <span class="keyword">this</span>.showteacher();</span><br><span class="line">            <span class="comment">//此处代码出现的student不是直接朋友，不应该在School类里存在，应该在teacher类里解决</span></span><br><span class="line"><span class="comment">//        ArrayList&lt;student&gt; list1 = worker.getAllstudent();</span></span><br><span class="line"><span class="comment">//        for (student stu : list) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(stu.name);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//以下为正确写法</span></span><br><span class="line">            System.out.println(<span class="string">"-------学生信息---------"</span>);</span><br><span class="line">            <span class="keyword">for</span> (teacher tea:tealist) &#123;</span><br><span class="line">                tea.showstudent();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addtea</span><span class="params">(teacher tea)</span> </span>&#123;</span><br><span class="line">            tealist.add(tea);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;teacher&gt; <span class="title">getAllTeacher</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tealist;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showteacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (teacher tea : tealist) &#123;</span><br><span class="line">            System.out.println(tea.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="合成复用原则"><a href="#合成复用原则" class="headerlink" title="合成复用原则"></a>合成复用原则</h3><ul>
<li>尽量使用聚合，而不是集成<ul>
<li>如果B类需要使用A类的方法，继承的话耦合性会很高</li>
<li>可以在B类里传入一个A类的参数，调用A类的方法</li>
<li>可以在B类里定义一个A类的对象，然后使用A类的方法，这种方式是组合</li>
<li>聚合：在B类声明一个A类参数，然后声明一个set方法去实例化A类，然后就可以使用。</li>
</ul>
</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul>
<li>将需要变化的和不需要变化的部分区分开来设计</li>
<li>针对接口设计，而不是针对实现编程</li>
<li>所有的目的是为了松耦合</li>
</ul>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li>创建型类型<ul>
<li>单例模式</li>
<li>抽象工厂，原型模式</li>
<li>建造者模式</li>
<li>工厂模式</li>
</ul>
</li>
<li>结构型模式<ul>
<li>适配器模式</li>
<li>桥接模式</li>
<li>装饰模式</li>
<li>组合模式</li>
<li>外观模式</li>
<li>享元模式</li>
<li>代理模式</li>
</ul>
</li>
<li>行为型模式<ul>
<li>模板方法模式</li>
<li>命令模式</li>
<li>访问者模式</li>
<li>迭代器模式</li>
<li>观察者模式</li>
<li>终结者模式</li>
<li>备忘录模式</li>
<li>解释器模式</li>
<li>状态模式</li>
<li>测率模式</li>
<li>职责链模式</li>
</ul>
</li>
</ul>
<h1 id="UML基本介绍"><a href="#UML基本介绍" class="headerlink" title="UML基本介绍"></a>UML基本介绍</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li>Unified modeling language。统一建模语言，是一种用于软件系统分析和设计的语言工具，它用于帮助软件开发人员进行思考和记录思路的结果。</li>
<li>常用的工具 Rational Rose</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200701142157299.png" alt="image-20200701142157299"></p>
<h2 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h2><ul>
<li>用例图</li>
<li>静态结构图<ul>
<li>类图</li>
<li>对象图</li>
<li>包图</li>
<li>组件图</li>
<li>部署图</li>
</ul>
</li>
<li>动态行为图<ul>
<li>交互图</li>
<li>状态图</li>
<li>活动图</li>
</ul>
</li>
<li>类图是描述类与类之间的静态关系的，是UML图中最核心的</li>
</ul>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><h3 id="类之间的关系"><a href="#类之间的关系" class="headerlink" title="类之间的关系"></a>类之间的关系</h3><ul>
<li>依赖，泛化（继承），实现，关联，组合，聚合。</li>
</ul>
<h4 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h4><ul>
<li>介绍：如果在类中用到了对方，那么就存在依赖关系。可以是用到类的成员属性，方法的返回类型或者方法中使用到，以及参数是类。</li>
</ul>
<h4 id="泛化关系"><a href="#泛化关系" class="headerlink" title="泛化关系"></a>泛化关系</h4><ul>
<li>是依赖关系的特例，是继承关系。</li>
</ul>
<h4 id="关联关系"><a href="#关联关系" class="headerlink" title="关联关系"></a>关联关系</h4><ul>
<li>依赖关系的特例，具有导航性，表示类与类之间的联系。<ul>
<li>单向一对一</li>
<li>双向一对一</li>
</ul>
</li>
</ul>
<h4 id="聚合关系"><a href="#聚合关系" class="headerlink" title="聚合关系"></a>聚合关系</h4><ul>
<li><p>表示整体和部分的关系，整体和部分可以分开。聚合关系是关联关系的特例，具有导航性和多重性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;<span class="comment">//可分离的。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="组合关系"><a href="#组合关系" class="headerlink" title="组合关系"></a>组合关系</h4><ul>
<li><p>表示整体和部分的关系，整体和部分是不可分离的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse = <span class="keyword">new</span> Mouse();<span class="comment">//不可分离的，产生和销毁是关联的。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>级联删除的情况下也是组合关系</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="ckbbzdvto000lt8ub3sv52qmu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/nginx/" class="article-date">
  <time datetime="2020-05-19T23:47:56.481Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/nginx/">nginx</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="第一章-Nginx基本概念"><a href="#第一章-Nginx基本概念" class="headerlink" title="第一章 Nginx基本概念"></a>第一章 Nginx基本概念</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>什么是Nginx</p>
<p>nginx是一个轻量级的高性能的HTTP和反向代理Web服务器。专门为性能而生，有报告显示，可以支持高达50000个连接数。</p>
</li>
<li><p>优点</p>
<p>占用内存少，并发能力强。</p>
</li>
</ul>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><ul>
<li><p>正向代理</p>
<p>Nginx不仅可以做反向代理，实现负载均衡。还能用做正向代理来进行上网等功能。</p>
<p>正向代理：如果把局域网外的Internet想象成一个巨大的资源库，则局域网中的客户端要访问Internet，则需要通过代理服务器来访问，这种代理服务称为正向代理。</p>
</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616194405669.png" alt="image-20200616194405669"></p>
<ul>
<li><p>上图是通过代理服务器访问谷歌，即正向代理。</p>
</li>
<li><p>反向代理</p>
<p>客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，<strong>暴露的是代理服务器地址</strong>，<strong>隐藏了真实服务器IP地址</strong>。</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616200631773.png" alt="image-20200616200631773"></p>
</li>
</ul>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><ul>
<li><p>传统的方式：客户端可以发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行交互，服务器处理完毕后，再将结果返回给客户端。在并发较小的情况下，是可以支持的。但是项目并发要求高，请求量大的情况下，会出现很多性能问题。</p>
</li>
<li><p>负载均衡：增加服务器的数量，将请求尽可能平均分发到多个服务器上。</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616201349988.png" alt="image-20200616201349988"></p>
</li>
</ul>
<h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><ul>
<li><p>为了加快网站的解析速度，可以把动态页面和静态页面分配给不同的服务器部署。</p>
<h1 id="第二章-安装Nginx，常用命令和配置文件"><a href="#第二章-安装Nginx，常用命令和配置文件" class="headerlink" title="第二章 安装Nginx，常用命令和配置文件"></a>第二章 安装Nginx，常用命令和配置文件</h1></li>
</ul>
<h2 id="在linux系统中安装nginx"><a href="#在linux系统中安装nginx" class="headerlink" title="在linux系统中安装nginx"></a>在linux系统中安装nginx</h2><ol>
<li><p>远程终端打开linux系统</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616211607012.png" alt="image-20200616211607012"></p>
<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200616211623412.png" alt="image-20200616211623412" style="zoom:33%;">

<ul>
<li><p>安装pcre</p>
<p>将文件从windows拖到Xshell命令行下，可以复制到当前目录</p>
<p>tar -xvf pcre-8.37.atr.gz</p>
<p>cd pcre-8.37</p>
<p>./configure</p>
<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200616213211137.png" alt="image-20200616213211137" style="zoom:50%;">

<p>make &amp;&amp; make install：编译并且安装</p>
<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200616213251020.png" alt="image-20200616213251020" style="zoom:50%;">

<ul>
<li><p>注意：./configure检查配置时有可能缺少很多前置应用，需要安装</p>
<p>yum -y install kernel-headers kernel-devel gcc</p>
<p>yum -y install gcc-c++</p>
</li>
<li><p>查看是否安装成功：</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616213438518.png" alt="image-20200616213438518"></p>
</li>
</ul>
</li>
<li><p>使用yum安装其他以依赖</p>
<p>yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</p>
</li>
<li><p>安装niginx</p>
<ol>
<li>将安装文件放到linux系统</li>
<li>解压文件</li>
<li>./config</li>
<li>make &amp;&amp; make install</li>
</ol>
<ul>
<li>安装成功后，在/usr/local/nginx/sbin/下有一个nginx启动脚本</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>注意：在安装成功后，防火墙设置默认没有端口号为nginx开放，需要自己设置端口号</p>
<ul>
<li><p>在/usr/local/nginx/conf/nginx.conf文件里有默认端口号配置信息（80端口）</p>
</li>
<li><p>查看防火墙开放的端口号</p>
<p>firewall-cmd –list-all</p>
</li>
<li><p>添加开放的端口号</p>
<p>sudo firewall-cmd –add-port=80/tcp –permanent</p>
</li>
<li><p>重启防火墙</p>
<p>firewall-cmd –reload</p>
</li>
</ul>
</li>
</ul>
<h2 id="nginx常用命令"><a href="#nginx常用命令" class="headerlink" title="nginx常用命令"></a>nginx常用命令</h2><ul>
<li><p>使用nginx需要进入/usr/local/nginx/sbin目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;nginx -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启nginx服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;nginx -s start</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭nginx服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;nginx -s stop</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新在nginx</p>
<p>不需要重启nginx服务器，重新加载配置文件即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;nginx -s reload</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="nginx配置文件"><a href="#nginx配置文件" class="headerlink" title="nginx配置文件"></a>nginx配置文件</h2><ul>
<li><p>位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h3><ul>
<li><p>全局块</p>
<p>从配置文件开始到events之间的内容，主要会设置一些影响nginx服务器整体运行的指令，主要包括配置运行nginx服务器的用户（组），允许生产的worker process数，进程PID存放路径，日志存放路径和类型以及配置文件的引入等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 1;</span><br></pre></td></tr></table></figure>

<p>这是Nginx服务器并发处理服务的关键配置，worker_processes值越大，可以支持的并发处理量也越多，但是会受到硬件，软件等配置的制约。</p>
</li>
<li><p>events块</p>
<p>nginx主要影响Nginx服务器与用户的网络连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>​        上述events块中的个内容表示支持的最大连接数时 1024个</p>
<ul>
<li><p>http块（配置最频繁的部分）</p>
<p>代理，缓存和日志定义绝大多数功能和第三方模块的配置都在这里，分为http全局快和server块。</p>
<ul>
<li><p>http全局块</p>
<p>http全局快配置的指令包括文件引入，MIME_TYPE定义，日志定义，连接超时时间，但连接请求数上线等。</p>
</li>
<li><p>server块</p>
<p>这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。</p>
<p>每个http块包含多个server块，而每个server块就相当于一个虚拟主机</p>
<p>而每个server块也分为全局server块，以及可以同时包含多个location块</p>
<ul>
<li><p>全局server块</p>
<p>最常见的配置时本虚拟机主机的监听配置和本溪你寄主机的名称或IP配置</p>
</li>
<li><p>location块</p>
<p>一个server块可以配置多个location块</p>
<p>这块的主要作用是基于Nginx服务器接收到的请求字符串，对虚拟主机名称之外的字符串进行匹配，对特定的请求进行处理。地址定向，数据缓存和应答控制等功能，还有许多第三方模块的配置也在这。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="第三章-Nginx配置实例"><a href="#第三章-Nginx配置实例" class="headerlink" title="第三章 Nginx配置实例"></a>第三章 Nginx配置实例</h1><h2 id="反向代理-1"><a href="#反向代理-1" class="headerlink" title="反向代理"></a>反向代理</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li><p>在Linux系统汇中安装tomcat使用默认端口8080</p>
</li>
<li><p>加入对外开放的端口号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port&#x3D;8080&#x2F;tcp --permanent</span><br><span class="line"></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看已经开放的端口号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>
</li>
<li><p>在windows浏览器访问tomcat服务器</p>
<ul>
<li>windows访问网址的过程：<ol>
<li>根据域名去本地的host文件找ip地址，如果没有，通过dns解析出ip</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="访问过程"><a href="#访问过程" class="headerlink" title="访问过程"></a>访问过程</h3><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618143827811.png" alt="image-20200618143827811"></p>
<h3 id="实例1"><a href="#实例1" class="headerlink" title="实例1"></a>实例1</h3><ol>
<li><p>在windows系统的host文件进行域名和ip对应关系的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.208.130 www.123.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>在nginx进行请求转发的配置（反向代理）</p>
<ul>
<li><p>找到nginx配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改server块相关内容</p>
<pre><code>server {
        listen       80;//向外展示的端口号
        server_name  192.168.208.130; //此处修改成本机的IP
    location / {
        root   html;
        proxy_pass http://127.0.0.1:8080;//tomcat向外隐藏只有nginx看到的ip和duan&apos;kou&apos;hao
        index  index.html index.htm;
    }</code></pre></li>
</ul>
</li>
<li><p>配置完成，启动nginx，在windows中访问<a href="http://www.123.com" target="_blank" rel="noopener">www.123.com</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin</span><br><span class="line">.&#x2F;nginx</span><br></pre></td></tr></table></figure>

<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200618145403876.png" alt="image-20200618145403876" style="zoom:50%;">

</li>
</ol>
<h3 id="实例2"><a href="#实例2" class="headerlink" title="实例2"></a>实例2</h3><h4 id="实现的效果"><a href="#实现的效果" class="headerlink" title="实现的效果"></a>实现的效果</h4><ul>
<li><p>使用nginx反向代理，根据访问的路径跳转到不同端口的服务中，nginx监听端口为9001。</p>
<p>访问<a href="http://127.0.0.1:9001/edu/" target="_blank" rel="noopener">http://127.0.0.1:9001/edu/</a> 直接跳转到127.0.0.1:8080</p>
<p>访问<a href="http://127.0.0.1:9001/vod/" target="_blank" rel="noopener">http://127.0.0.1:9001/vod/</a> 直接跳转到127.0.0.1:8081</p>
</li>
</ul>
<h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><ul>
<li><p>准备两个服务器，一个8080端口，一个8081端口</p>
</li>
<li><p>在/usr/src/下创建两个文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir tomcat8080</span><br><span class="line">mkdir tomcat8081</span><br></pre></td></tr></table></figure>
</li>
<li><p>分别在这两个目录下复制一份tomcat压缩文件并解压</p>
</li>
<li><p>配置环境变量（base和home名需要起的不一样）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#tomcat8080</span><br><span class="line">CATALINA0_BASE&#x3D;&#x2F;usr&#x2F;src&#x2F;tomcat8080&#x2F;apache-tomcat-7.0.70</span><br><span class="line">CATALINA0_HOME&#x3D;&#x2F;usr&#x2F;src&#x2F;tomcat8080&#x2F;apache-tomcat-7.0.70</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;CATALINA0_HOME&#125;&#x2F;bin&#x2F;tomcat-juli.jar:$&#123;CATALINA0_HOME&#125;&#x2F;bin&#x2F;bootstrap.jar</span><br><span class="line">export CATALINA0_BASE CATALINA0_HOME</span><br><span class="line"></span><br><span class="line">#tomcat8081</span><br><span class="line">CATALINA1_BASE&#x3D;&#x2F;usr&#x2F;src&#x2F;tomcat8081&#x2F;apache-tomcat-7.0.70</span><br><span class="line">CATALINA1_HOME&#x3D;&#x2F;usr&#x2F;src&#x2F;tomcat8081&#x2F;apache-tomcat-7.0.70</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;CATALINA1_HOME&#125;&#x2F;bin&#x2F;tomcat-juli.jar:$&#123;CATALINA1_HOME&#125;&#x2F;bin&#x2F;bootstrap.jar</span><br><span class="line">export CATALINA1_BASE CATALINA1_HOME</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改两个tomcat启动寻找路径文件/bin/caralina.sh(找到如下注释，插入以下两行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#OS specific support.  $var _must_ be set to either true or false.</span><br><span class="line">export CATALINA_BASE&#x3D;$CATALINA0_BASE</span><br><span class="line">export CATALINA_HOME&#x3D;$CATALINA0_HOME</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看防火墙对应端口号是否开启，如果没有，开启端口号。</p>
</li>
<li><p>准备测试的文件夹</p>
<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200618155440733.png" alt="image-20200618155440733">

<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618155504464.png" alt="image-20200618155504464"></p>
</li>
</ul>
<h4 id="具体配置"><a href="#具体配置" class="headerlink" title="具体配置"></a>具体配置</h4><ul>
<li><p>找到nginx配置文件/usr，进行反向代理配置</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618160142518.png" alt="image-20200618160142518"></p>
</li>
<li><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618160104821.png" alt="image-20200618160104821"></p>
</li>
</ul>
<ul>
<li><p>开放9001端口</p>
<p>firewall-cmd –add-port=8080/tcp –permanent</p>
<p>firewall-cmd –reload</p>
</li>
<li><p>关闭nginx服务重新启动，访问页面</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618162705438.png" alt="image-20200618162705438"></p>
</li>
</ul>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>需要确定自己实在同一个nginx文件里面配置，有可能安装了多个nginx，配置错了。</li>
</ul>
<h2 id="负载均衡-1"><a href="#负载均衡-1" class="headerlink" title="负载均衡"></a>负载均衡</h2><h3 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h3><ul>
<li>浏览器地址栏输入地址：<a href="http://192.168.208.130/edu/a.html，负载均衡效果，平均8080和8081端口中" target="_blank" rel="noopener">http://192.168.208.130/edu/a.html，负载均衡效果，平均8080和8081端口中</a></li>
</ul>
<h3 id="准备工作-1"><a href="#准备工作-1" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li>准备两台服务器tomcat8080和tomcat8081</li>
<li>在两台tomcat里面webapps目录这种，创建edu文件夹，并且创建a.html。</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul>
<li><p>在http块中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver&#123;</span><br><span class="line">        server 192.168.208.130:8080;</span><br><span class="line">        server 192.168.208.130:8081;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在location中添加（需要保证只有一个这样格式的语句）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass http:&#x2F;&#x2F;myserver;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动nginx，在windows端查看，会发现8080和8081端口会交替分担任务。</p>
</li>
</ul>
<h3 id="分配策略"><a href="#分配策略" class="headerlink" title="分配策略"></a>分配策略</h3><h4 id="轮询（默认）"><a href="#轮询（默认）" class="headerlink" title="轮询（默认）"></a>轮询（默认）</h4><ul>
<li>每个请求按照时间顺序注意分到不同的后端服务器，如果后端服务器down掉，能自动剔除。</li>
</ul>
<h4 id="weight"><a href="#weight" class="headerlink" title="weight"></a>weight</h4><ul>
<li><p>weight代表权重，默认为1，权重越高被分配的客户端越多</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver&#123;</span><br><span class="line">        server 192.168.208.130:8080 weight &#x3D; 5;</span><br><span class="line">        server 192.168.208.130:8081 weight &#x3D; 10;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip hash"></a>ip hash</h4><ul>
<li><p>每个请求按照访问ip的hash结果分配，这样每个方可固定访问一个后端服务器，可以解决session问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver&#123;</span><br><span class="line">		ip_hash;</span><br><span class="line">        server 192.168.208.130:8080 weight &#x3D; 5;        			server 192.168.208.130:8081 weight &#x3D; 10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="fair-第三方"><a href="#fair-第三方" class="headerlink" title="fair(第三方)"></a>fair(第三方)</h4><ul>
<li><p>按后端服务器的响应时间来分配强求，响应时间越短就优先分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver&#123;</span><br><span class="line">     server 192.168.208.130:8080 weight &#x3D; 5;        </span><br><span class="line">	 server 192.168.208.130:8081 weight &#x3D; 10;</span><br><span class="line">	 fair；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="动静分离-1"><a href="#动静分离-1" class="headerlink" title="动静分离"></a>动静分离</h2><ul>
<li><p>目的：提高访问效率</p>
</li>
<li><p>将动态请求和静态请求分离开来，使用Nginx处理静态页面，Tomcat处理动态页面</p>
</li>
<li><p>分为两种方式：</p>
<ul>
<li>方式一：纯粹把静态文件成单独的域名，放在独立的服务器上，也是目前主流推崇的方案</li>
<li>方式二：动态和静态混合在一起发布，通过nginx分开</li>
</ul>
</li>
<li><p>通过location指定不同的后缀名实现不同的请求转发。通过expires参数设置，可以使浏览器缓存过期时间，减少与服务器之间的请求和流量。机里expires定义：给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。</p>
</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618172526127.png" alt="image-20200618172526127"></p>
<h3 id="准备工作-2"><a href="#准备工作-2" class="headerlink" title="准备工作"></a>准备工作</h3><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618181908923.png" alt="image-20200618181908923"></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618181921728.png" alt="image-20200618181921728"></p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618182258446.png" alt="image-20200618182258446"></p>
<h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><h3 id="最终测试效果"><a href="#最终测试效果" class="headerlink" title="最终测试效果"></a>最终测试效果</h3><ul>
<li><p>访问<a href="http://192.168.208.130/image/String%E5%AE%9E%E4%BE%8B%E5%8C%96.png" target="_blank" rel="noopener">http://192.168.208.130/image/String%E5%AE%9E%E4%BE%8B%E5%8C%96.png</a></p>
<img src="/111zx/111zx.github.io/2020/05/20/nginx/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200618183357858.png" alt="image-20200618183357858" style="zoom: 25%;">
</li>
<li><p>访问<a href="http://192.168.208.130/www/a.html" target="_blank" rel="noopener">http://192.168.208.130/www/a.html</a></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200618183420803.png" alt="image-20200618183420803"></p>
</li>
</ul>
<h2 id="配置高并发可用集群"><a href="#配置高并发可用集群" class="headerlink" title="配置高并发可用集群"></a>配置高并发可用集群</h2><ul>
<li><p>传统方式的问题：nginx宕机时，服务会无法进行</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619104710350.png" alt="image-20200619104710350"></p>
</li>
<li><p>高可用集群：主nginx服务器宕机后会自动切换到备用nginx服务器</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619105058735.png" alt="image-20200619105058735"></p>
<ul>
<li><p>高可用集群条件：</p>
<ul>
<li>两台nginx服务器</li>
<li>在两台服务器中安装nginx软件</li>
<li>在两台服务器中安装keepalived</li>
</ul>
</li>
<li><p>安装keepalived：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived</span><br></pre></td></tr></table></figure>
</li>
<li><p>在/etc/keepalived下会生成配置文件</p>
</li>
<li><p>克隆一个主机slave2</p>
</li>
</ul>
</li>
<li><p>完成高可用配置</p>
<ol>
<li><p><strong>修改/etc/keepalived/keepalived.conf</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line">  </span><br><span class="line">global_defs &#123;</span><br><span class="line">     notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">       failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">     &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">     smtp_server 192.168.208.130 # 主机ip，不管主从服务器都是这个ip，必须填写主服务ip</span><br><span class="line">   smtp_connect_timeout 30 # 超时时间</span><br><span class="line">     router_id master # 主机名称 vi &#x2F;etc&#x2F;hosts  类似这样的格式：127.0.0.1   master</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  vrrp_instance VI_1 &#123;</span><br><span class="line">      state MASTER #主机为MASTER 备用机为BACKUP</span><br><span class="line">      interface ens33 # 网卡号，ifconfig可查看</span><br><span class="line">      virtual_router_id 51 # 主机和备用机必须一样</span><br><span class="line">      priority 100 # 主机一般设计为100  备用机低于100</span><br><span class="line">      advert_int 1 # 每隔1s发送一个心跳，检测服务机状态</span><br><span class="line">  	</span><br><span class="line">      authentication &#123;# 判断依据</span><br><span class="line">          auth_type PASS</span><br><span class="line">          auth_pass 1111</span><br><span class="line">      &#125;</span><br><span class="line">      virtual_ipaddress &#123;# 虚拟ip 需要和主机在一个网段</span><br><span class="line">          192.168.200.50</span><br><span class="line">          192.168.200.51</span><br><span class="line">          192.168.200.52</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  vrrp_script chk_http_port&#123;</span><br><span class="line">  	script &quot;&#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx_check.sh&quot; # 脚本位置</span><br><span class="line">  	interval 2 # 检测脚本执行的间隔</span><br><span class="line">  	weight -20 # 主服务器宕机的话让主服务器权重-20，备用服务器就可以顶上</span><br><span class="line">  	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在/usr/local/src添加检测脚本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">A&#x3D;&#96;ps -C nginx –no-header |wc -l&#96;</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line">    &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</span><br><span class="line">    sleep 2</span><br><span class="line">    if [ &#96;ps -C nginx --no-header |wc -l&#96; -eq 0 ];then</span><br><span class="line">        killall keepalived</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ul>
<ol start="3">
<li><p>在两台服务器启动niginx和keepalived</p>
<p>./nginx</p>
<p>systemctl start keepalived.service</p>
</li>
<li><p>测试</p>
<ol>
<li><p>在浏览器输入ip地址192.168.208.50（虚拟ip在linux上通过指令 ip a可以查看）</p>
</li>
<li><p>将主服务器192.160.208.130停止，然后测试</p>
</li>
</ol>
</li>
<li><p>演示：kill</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619154627120.png" alt="image-20200619154627120"></p>
</li>
</ol>
<h1 id="Nginx执行原理"><a href="#Nginx执行原理" class="headerlink" title="Nginx执行原理"></a>Nginx执行原理</h1><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619162241983.png" alt="image-20200619162241983"></p>
<ul>
<li><p>nginx启动有两个进程 worker和nginx</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619162354529.png" alt="image-20200619162354529"></p>
<ul>
<li><p>worker（<strong>可以有多个worker</strong>）：实际工人</p>
<p>完成master分配来的任务</p>
</li>
<li><p>master（<strong>一个</strong>）：管理员</p>
<p>分配任务给worker</p>
</li>
</ul>
</li>
</ul>
<h3 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h3><p><img src="/111zx/111zx.github.io/2020/05/20/nginx/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200619162513285.png" alt="image-20200619162513285"></p>
<ul>
<li><p>管理员发送请求，先到niginx的master进程，worker接收到master的任务信息，通过<strong>争抢机制</strong>获取请求，并通过反向代理或者和tomcat配合完成具体操作。</p>
</li>
<li><p><strong>一个master多个worker的优点</strong></p>
<ul>
<li>可以使用nginx -s reload热部署，工作的worker可以干自己的事情，空闲的worker重新加载修改的文件，完成之后可以以新的配置完成任务。</li>
<li>worker时独立的进程，不需要加锁，省掉了锁的开销。</li>
<li>有一个worker挂掉，master可以很快启动其他的worker完成这件任务。不会造成服务中断。</li>
</ul>
</li>
<li><p><strong>设置worker数量的根据</strong></p>
<p>Nginx和redis采用了io多路复用机制。<strong>在windows中这个机制无法产生效果。</strong></p>
<p>每个worker线程需要把cpu的性能发挥到极致。<strong>几个cpu设置几个worker</strong>。</p>
</li>
<li><p>worker连接数worker_connection</p>
<ul>
<li><p>发送一个请求，占用了worker几个连接数</p>
<p>答案：<strong>2个或者4个。</strong></p>
<ul>
<li>2个：访问静态资源，只需要在nginx进行。nginx直接和客户机交互一来一回两次。</li>
<li>4个：需要访问数据库，要经过tomcat。nginx需要通过反向代理经过tomcat完成客户机的请求，需要4个链接</li>
</ul>
</li>
<li><p>nginx有一个master，有四个worker，每个worker最大连接数1024个，求<strong>最大的并发数</strong></p>
<p>worker数量 * worker最大连接数 / 2</p>
<p>如果是http作为反向代理，需要经过tomcat：worker数量 * worker最大连接数 / 2</p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/nginx/" data-id="ckbbzdvse0007t8ubg10y32vq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-tomcat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/tomcat/" class="article-date">
  <time datetime="2020-05-19T23:46:11.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/tomcat/">tomact</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="第一章-Tomcat概念"><a href="#第一章-Tomcat概念" class="headerlink" title="第一章 Tomcat概念"></a>第一章 Tomcat概念</h1><h2 id="1-1-Web概念"><a href="#1-1-Web概念" class="headerlink" title="1-1 Web概念"></a>1-1 Web概念</h2><h3 id="1-1-1-架构"><a href="#1-1-1-架构" class="headerlink" title="1-1-1 架构"></a>1-1-1 架构</h3><ul>
<li>C/S：客户端/服务器端。QQ……</li>
<li>B/S：浏览器/服务器端。京东，网易官网</li>
</ul>
<h3 id="1-1-2-资源"><a href="#1-1-2-资源" class="headerlink" title="1-1-2 资源"></a>1-1-2 资源</h3><ul>
<li><p>静态资源：所有用户访问得到的页面都是一样的。</p>
<ul>
<li>html,css,jpg,javascript</li>
</ul>
</li>
<li><p>动态资源：每个用户访问相同资源，得到的结果是不一样的。</p>
<ul>
<li><p>servlet/jsp,php,ssp</p>
</li>
<li><p>浏览器解析不了动态资源，动态资源在服务器转换成静态资源返回给浏览器</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-1-3-网络通信三要素"><a href="#1-1-3-网络通信三要素" class="headerlink" title="1-1-3 网络通信三要素"></a>1-1-3 网络通信三要素</h3><ul>
<li><p>协议（https/http）</p>
<ul>
<li>基础协议<ul>
<li>tcp：安全协议，三次握手，速度较慢</li>
<li>udp：不安全协议，速度快</li>
</ul>
</li>
</ul>
</li>
<li><p>域名（IP）</p>
</li>
<li><p>端口号</p>
</li>
</ul>
<h2 id="1-2-常见的Web服务器"><a href="#1-2-常见的Web服务器" class="headerlink" title="1-2 常见的Web服务器"></a>1-2 常见的Web服务器</h2><h3 id="1-2-1-概念"><a href="#1-2-1-概念" class="headerlink" title="1-2-1 概念"></a>1-2-1 概念</h3><ul>
<li>服务器：安装了服务器软件的计算机</li>
<li>服务器软件：接受用户的请求，处理请求，做出响应</li>
<li>Web服务器软件：接受用户的请求，处理请求，做出响应，在Web服务器中，可以部署Web项目，让用户通过浏览器来访问这些项目</li>
</ul>
<h3 id="1-2-2-常见Web服务器软件"><a href="#1-2-2-常见Web服务器软件" class="headerlink" title="1-2-2 常见Web服务器软件"></a>1-2-2 常见Web服务器软件</h3><ul>
<li>webLogic:Oracle公司</li>
<li>webSphere：IBM公司</li>
<li>JBOSS：JBOSS公司</li>
<li>Tomcat：开源的，免费的。Apache公司</li>
</ul>
<h2 id="1-3-Tomcat-历史"><a href="#1-3-Tomcat-历史" class="headerlink" title="1-3 Tomcat 历史"></a>1-3 Tomcat 历史</h2><ul>
<li>Sun公司的软件架构师james开发，名为“JavaWebServer”</li>
</ul>
<h2 id="1-4-Tomcat-安装"><a href="#1-4-Tomcat-安装" class="headerlink" title="1-4 Tomcat 安装"></a>1-4 Tomcat 安装</h2><h3 id="1-4-1-下载zip解压包"><a href="#1-4-1-下载zip解压包" class="headerlink" title="1-4-1 下载zip解压包"></a>1-4-1 下载zip解压包</h3><ul>
<li>下载完成解压即可</li>
</ul>
<h3 id="1-4-2-目录"><a href="#1-4-2-目录" class="headerlink" title="1-4-2 目录"></a>1-4-2 目录</h3><ul>
<li><p>bin目录（存放可执行程序）</p>
<ul>
<li>startup.dat：启动tomcat脚本</li>
<li>shutdown.dat：关闭脚本</li>
<li>.bat:windows 批处理脚本</li>
<li>.sh:linux shell脚本</li>
</ul>
</li>
<li><p>config（配置文件）</p>
<ul>
<li>logging.properties：日志配置文件</li>
<li>server.xml：当前tomcat运行的配置信息</li>
<li>tomcat-user.xml：tomcat访问用户以及每个用户的角色信息</li>
<li>web.xml:部署的所有应用的配置文件，默认的servlet等</li>
</ul>
</li>
<li><p>lib</p>
<ul>
<li>依赖的jar包</li>
</ul>
</li>
<li><p>logs</p>
<ul>
<li>日志信息</li>
</ul>
</li>
<li><p>temp</p>
<ul>
<li>临时信息</li>
</ul>
</li>
<li><p>webapps</p>
<ul>
<li>默认的web应用部署文件</li>
</ul>
</li>
<li><p>work</p>
<ul>
<li>jsp文件编译后的java源码和字节码存放位置</li>
</ul>
</li>
</ul>
<h2 id="1-5-Tomcat启动和停止"><a href="#1-5-Tomcat启动和停止" class="headerlink" title="1-5 Tomcat启动和停止"></a>1-5 Tomcat启动和停止</h2><ul>
<li><p>启动：执行startup.dat</p>
</li>
<li><p>停止：执行shutdown.dat，或者关闭前台窗口</p>
</li>
</ul>
<h2 id="1-6-tomcat源码"><a href="#1-6-tomcat源码" class="headerlink" title="1-6 tomcat源码"></a>1-6 tomcat源码</h2><ul>
<li><p>下载地址：<a href="https://tomcat.apache.org/download-80.cgi#8.5.56" target="_blank" rel="noopener">https://tomcat.apache.org/download-80.cgi#8.5.56</a></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200620103403719.png" alt="image-20200620103403719"></p>
</li>
<li><p>运行tomcat源码</p>
<ol>
<li><p>在idea创建一个空项目，将源码压缩包放到项目中</p>
</li>
<li><p>进入解压目录，创建一个home目录，将conf，webapps目录移入到home目录当中</p>
</li>
<li><p>在当前目录下创建一个pom.xml文件,复制粘贴依赖信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;Tomcat8.5&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;name&gt;Tomcat8.5&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;version&gt;8.5&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;finalName&gt;Tomcat8.5&lt;&#x2F;finalName&gt;</span><br><span class="line">        &lt;sourceDirectory&gt;java&lt;&#x2F;sourceDirectory&gt;</span><br><span class="line">        &lt;testSourceDirectory&gt;test&lt;&#x2F;testSourceDirectory&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;java&lt;&#x2F;directory&gt;</span><br><span class="line">            &lt;&#x2F;resource&gt;</span><br><span class="line">        &lt;&#x2F;resources&gt;</span><br><span class="line">        &lt;testResources&gt;</span><br><span class="line">           &lt;testResource&gt;</span><br><span class="line">                &lt;directory&gt;test&lt;&#x2F;directory&gt;</span><br><span class="line">           &lt;&#x2F;testResource&gt;</span><br><span class="line">        &lt;&#x2F;testResources&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;&#x2F;encoding&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.easymock&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easymock&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.4&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ant&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;ant&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;wsdl4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;wsdl4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.6.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.xml&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jaxrpc&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;ecj&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.5.1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">       </span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在idea中，导入该工程。</p>
<img src="/111zx/111zx.github.io/2020/05/20/tomcat/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200620120336627.png" alt="image-20200620120336627" style="zoom:50%;">
</li>
</ol>
</li>
</ul>
<ol start="5">
<li><p>配置IDEA运行项目</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200620120628494.png" alt="image-20200620120628494"></p>
<ul>
<li><p>虚拟机选项的相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-Dcatalina.home&#x3D;E:&#x2F;firefox下载&#x2F;itcast_project_tomcat&#x2F;apache-tomcat-8.5.56-src&#x2F;home</span><br><span class="line">-Dcatalina.base&#x3D;E:&#x2F;firefox下载&#x2F;itcast_project_tomcat&#x2F;apache-tomcat-8.5.56-src&#x2F;home</span><br><span class="line">-Djava.util.logging.manager&#x3D;org.apache.juli.ClassLoaderLogManager</span><br><span class="line">-Djava.util.logging.config.fileE:&#x2F;firefox下载&#x2F;itcast_project_tomcat&#x2F;apache-tomcat-8.5.56-src&#x2F;home&#x2F;conf&#x2F;logging.properties</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注意：如果编译build的时候出现Test测试代码报错，注释该代码即可。本文中的Tomcat源码util.TestCookieFilter类会报错，将其注释即可</strong></p>
</li>
</ul>
</li>
</ol>
<ol start="6">
<li><p><strong>加载org.apache.jasper.servlet.JasperInitializer</strong>，否则无法编译jsp</p>
<ul>
<li><p>解决办法是在tomcat的源码org.apache.catalina.startup.ContextConfig中的configureStart函数中手动将JSP解析器初始化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">configureStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Called from StandardContext.start()</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(sm.getString(<span class="string">"contextConfig.start"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(sm.getString(<span class="string">"contextConfig.xmlSettings"</span>,</span><br><span class="line">                    context.getName(),</span><br><span class="line">                    Boolean.valueOf(context.getXmlValidation()),</span><br><span class="line">                    Boolean.valueOf(context.getXmlNamespaceAware())));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        webConfig();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">此处加入 context.addServletContainerInitializer(new JasperInitializer(), null);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        context.addServletContainerInitializer(<span class="keyword">new</span> JasperInitializer(), <span class="keyword">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!context.getIgnoreAnnotations()) &#123;</span><br><span class="line">            applicationAnnotationsConfig();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">            validateSecurityRoles();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configure an authenticator if we need one</span></span><br><span class="line">        <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">            authenticatorConfig();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Dump the contents of this pipeline if requested</span></span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(<span class="string">"Pipeline Configuration:"</span>);</span><br><span class="line">            Pipeline pipeline = context.getPipeline();</span><br><span class="line">            Valve valves[] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (pipeline != <span class="keyword">null</span>) &#123;</span><br><span class="line">                valves = pipeline.getValves();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (valves != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; valves.length; i++) &#123;</span><br><span class="line">                    log.debug(<span class="string">"  "</span> + valves[i].getClass().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">"======================"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make our application available if no problems were encountered</span></span><br><span class="line">        <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">            context.setConfigured(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(sm.getString(<span class="string">"contextConfig.unavailable"</span>));</span><br><span class="line">            context.setConfigured(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>启动tomcat，访问http:localhost:8080</p>
<img src="/111zx/111zx.github.io/2020/05/20/tomcat/Users\14914\AppData\Roaming\Typora\typora-user-images\image-20200620121054164.png" alt="image-20200620121054164" style="zoom:50%;">

</li>
</ol>
<h1 id="第二章-Tomcat架构"><a href="#第二章-Tomcat架构" class="headerlink" title="第二章 Tomcat架构"></a>第二章 Tomcat架构</h1><h2 id="2-1-http工作原理"><a href="#2-1-http工作原理" class="headerlink" title="2-1 http工作原理"></a>2-1 http工作原理</h2><ul>
<li><p>http协议是浏览器和服务器之间的数据传送协议。作为应用层协议，http是基于TCP/IP协议来传递数据的，HTTP协议不涉及数据包传输，主要规定了客户端和服务器之间的通信格式。</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200621161537992.png" alt="image-20200621161537992"></p>
</li>
<li><p>主要过程：</p>
<ol>
<li>用户通过浏览器进行了一个操作，比如输入网址并回车，或者是点击连接，接着浏览器获取了整个事件。</li>
<li>浏览器像服务端发出TCP连接</li>
<li>服务程序接收浏览器的连接请求，并经过TCP三次握手建立连接</li>
<li>浏览器将请求数据打包成一个HTTP协议格式的数据包</li>
<li>浏览器将数据包推入网络，数据包经过网络传输，最终达到服务程序</li>
<li>服务端程序拿到这个数据包后，同样以HTTP协议格式解包，获取到客户端的意图。</li>
<li>得知客户端意图后进行处理，比如提供静态文件或者调用服务端程序获得动态结果。</li>
<li>服务器将响应结果按照HTTP协议格式打包</li>
<li>服务器将响应数据包推入网络，数据包经过网络传输最终达到浏览器。</li>
<li>浏览器拿到数据包后，以http协议的格式解包，然后解析数据，假设这里的数据是html</li>
<li>浏览器将HTML文件展示在页面上</li>
</ol>
<p>Tomcat作为一个HTTP服务器，主要是接受链接，解析请求数据，处理请求和发送响应这个几个步骤。</p>
</li>
</ul>
<h2 id="2-2-Tomcat整体架构"><a href="#2-2-Tomcat整体架构" class="headerlink" title="2-2 Tomcat整体架构"></a>2-2 Tomcat整体架构</h2><h3 id="2-2-1-Http服务器去请求处理"><a href="#2-2-1-Http服务器去请求处理" class="headerlink" title="2-2-1 Http服务器去请求处理"></a>2-2-1 Http服务器去请求处理</h3><p>浏览器发给服务端的是一个HTTP格式的请求，HTTP服务器收到这个请求后，需要调用服务端程序来处理，所谓服务端程序就是你写的Java类，一般来说不同请求需要不同的Java类来处理。</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200621162607297.png" alt="image-20200621162607297"></p>
<ul>
<li>图1：表示HTTP服务器直接调用具体业务类，他们是<strong>紧耦合</strong>的。</li>
<li>图2：HTTP服务器不直接调用业务类，而是把请求交给容器来处理，容器通过Servlet接口调用业务类。因此Servlet接口和Servlet容器的出现，达到了HTTP服务器和业务类解耦的目的，而Servelt接口和Servlet容器这一整套规范叫做Servelt规范。Tmcat按照Servlet规范要求实现了Servlet容器，同时他们也具有HTTP服务器的功能。作为Java程序员，如果我们要实现新的业务类功能，只需要实现一个Servelt，并把它注册到Tomcat（Servlet容器）中，剩下的事情就由Tomcat帮我们处理了。</li>
</ul>
<h3 id="2-2-2-Servlet容器工作流程"><a href="#2-2-2-Servlet容器工作流程" class="headerlink" title="2-2-2 Servlet容器工作流程"></a>2-2-2 Servlet容器工作流程</h3><ul>
<li><p>为了解耦，HTTP服务器不用直接调用Servlet，而是把请求交给Servlet来处理，那Servlet又是怎么工作的呢？</p>
<p>当客户请求某个资源时，HTTO服务器会用一个ServletRequest对象把客户的请求信息封装起来，然后调用Servlet容器的service方法，Servlet容器拿到请求后，根据请求的URL和Servlet的映射关系，找到相应的Servlet，如果Servlet还没有被加载，就用反射机制创建这个Servlet，并调用Servlet的init方法来完成初始化，接着调用Servlet的service方法来处理请求，把ServletResponse对象返回给HTTP服务器，HTTP服务器会把相应发送给客户端</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200621171938033.png" alt="image-20200621171938033"></p>
</li>
</ul>
<h3 id="2-2-3-Tomcat整体架构"><a href="#2-2-3-Tomcat整体架构" class="headerlink" title="2-2-3 Tomcat整体架构"></a>2-2-3 Tomcat整体架构</h3><ul>
<li><p>Tomcat具有两个核心功能：</p>
<ol>
<li>处理Socket连接，负责网络字节流与Request和Response对象的转化。</li>
<li>加载和管理Servlet，以及具体处理Request请求</li>
</ol>
<p>为了实现上述核心功能，Tomcat设计了两个核心组件：Connector和Container分别来做这两件事。</p>
<ul>
<li>Connector:接收请求，转化成ServletRequest对象发送给容器。Connector收到Container发送来的ServletResponse对象会先解析，再给TCP一个响应。</li>
<li>Container:拿到ServletRequest接下来定位容器中的Servlet，如果没有加载，先加载Servlet，再调用Servlet中的具体方法来执行。执行完毕后，会返回给Connector一个ServletResponse。</li>
</ul>
</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/tomcat/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200621173228668.png" alt="image-20200621173228668"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/tomcat/" data-id="ckbbzdvsr000bt8ubgt8d41kg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/maven/" class="article-date">
  <time datetime="2020-05-19T23:45:56.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/maven/">maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="依赖管理的概念"><a href="#依赖管理的概念" class="headerlink" title="依赖管理的概念"></a>依赖管理的概念</h2><ul>
<li>maven开发的crm项目，jar包不在项目中，在jar包仓库，项目中存了jar包的坐标。</li>
<li>传统的Web工程crmjar包在项目中，虽然一个项目浪费不了磁盘空间，但是多个项目使用同一个jar包，每次都要存储一个jar包，就会浪费空间</li>
<li>依赖管理：maven工程对jar包的管理过程</li>
</ul>
<h2 id="项目的一件构建"><a href="#项目的一件构建" class="headerlink" title="项目的一件构建"></a>项目的一件构建</h2><ul>
<li>本地安装：编译，测试，运行，打包，安装和部署</li>
<li>maven：一件构建</li>
</ul>
<h2 id="maven安装"><a href="#maven安装" class="headerlink" title="maven安装"></a>maven安装</h2><ul>
<li>最好安装路径不要有中文</li>
<li>bin包直接解压在没有中文的路径</li>
</ul>
<h2 id="仓库的种类和彼此的关系"><a href="#仓库的种类和彼此的关系" class="headerlink" title="仓库的种类和彼此的关系"></a>仓库的种类和彼此的关系</h2><ul>
<li><p>maven工程会根据jar包的坐标先去本地仓库找jar包，如果本地仓库没有jar包，则去中央仓库下载（要联网），也可以在本地上传。没有联网直接报错。</p>
</li>
<li><p>中央仓库几乎放了所有的jar包</p>
</li>
<li><p>远程仓库（私服）：只要自己的电脑和远程仓库在一个局域网，直接从远程仓库下载</p>
</li>
<li><p>重新指定本地仓库的路径：D:\maven\apache-maven-3.5.2\conf\settings</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span><br><span class="line"><span class="comment">//改成下面即可只要是没有中文的路径就可以，里面存jar包</span></span><br><span class="line"> &lt;localRepository&gt;D:\maven\localcangku&lt;/localRepository&gt;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="maven-标准目录结构"><a href="#maven-标准目录结构" class="headerlink" title="maven 标准目录结构"></a>maven 标准目录结构</h2><ul>
<li><p>一个项目的内容</p>
<ul>
<li>核心代码部分</li>
<li>配置文件部分</li>
<li>测试代码部分</li>
<li>测试配置文件</li>
</ul>
</li>
<li><p>maven项目标准目录结构</p>
<ul>
<li>src/main/java: 核心代码部分</li>
<li>src/main/resources:配置文件部分</li>
<li>src/test/java：测试代码部分</li>
<li>src/test/resources:测试配置文件</li>
<li>（Web开发才有）src/main/webapp:Web工程的页面资源，js，css，图片等</li>
</ul>
</li>
</ul>
<h1 id="Maven常用的命令"><a href="#Maven常用的命令" class="headerlink" title="Maven常用的命令"></a>Maven常用的命令</h1><h2 id="mvn-clean"><a href="#mvn-clean" class="headerlink" title="mvn clean"></a>mvn clean</h2><ul>
<li>删除所有编译信息（target目录）</li>
</ul>
<h2 id="mvn-compile"><a href="#mvn-compile" class="headerlink" title="mvn compile"></a>mvn compile</h2><ul>
<li>src/main下代码进行编译，放在target目录下</li>
</ul>
<h2 id="mvn-test"><a href="#mvn-test" class="headerlink" title="mvn test"></a>mvn test</h2><ul>
<li>不仅仅编译了src/test下代码，而且编译了src/main下代码</li>
</ul>
<h2 id="mvn-package"><a href="#mvn-package" class="headerlink" title="mvn package"></a>mvn package</h2><ul>
<li>不仅仅编译了src/test和src/main下代码，并且把项目打包，打包的格式在<strong>pom.xml</strong>中配置</li>
</ul>
<h2 id="mvn-install"><a href="#mvn-install" class="headerlink" title="mvn install"></a>mvn install</h2><ul>
<li>不仅仅编译了src/test和src/main下代码，打包项目，而且将项目打成包放到本地仓库</li>
</ul>
<h1 id="Maven生命周期"><a href="#Maven生命周期" class="headerlink" title="Maven生命周期"></a>Maven生命周期</h1><h2 id="自动构建步骤（默认生命周期）"><a href="#自动构建步骤（默认生命周期）" class="headerlink" title="自动构建步骤（默认生命周期）"></a>自动构建步骤（默认生命周期）</h2><ul>
<li><p>编译</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn compile</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn test</span><br></pre></td></tr></table></figure>
</li>
<li><p>打包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布(会把前面4个执行一遍)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="清理生命周期"><a href="#清理生命周期" class="headerlink" title="清理生命周期"></a>清理生命周期</h2><ul>
<li><p>清除项目编译信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="站点生命周期"><a href="#站点生命周期" class="headerlink" title="站点生命周期"></a>站点生命周期</h2><ul>
<li>……</li>
</ul>
<h1 id="Maven概念模型"><a href="#Maven概念模型" class="headerlink" title="Maven概念模型"></a>Maven概念模型</h1><p><img src="/111zx/111zx.github.io/2020/05/20/maven/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5CMaven%5C%E6%A8%A1%E5%9E%8B.png" alt></p>
<h2 id="项目对象模型POM"><a href="#项目对象模型POM" class="headerlink" title="项目对象模型POM"></a>项目对象模型POM</h2><ul>
<li>项目自身信息</li>
<li>项目所运行依赖的jar包信息</li>
<li>项目运行环境信息，jdk，tomact等</li>
</ul>
<h2 id="依赖管理模型"><a href="#依赖管理模型" class="headerlink" title="依赖管理模型"></a>依赖管理模型</h2><ul>
<li><p>放置的是jar包的坐标</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;5.1.6&lt;/version&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>有三个箭头指向三个仓库</p>
<ul>
<li>local</li>
<li>b2b（远程仓库）</li>
<li>center（联网下载）</li>
</ul>
</li>
</ul>
<h2 id="构建生命周期"><a href="#构建生命周期" class="headerlink" title="构建生命周期"></a>构建生命周期</h2><ul>
<li><p>每一个构建项目的命令都对应了maven底层的一个插件</p>
</li>
<li><p>一键构建</p>
</li>
</ul>
<h2 id="idea集成Maven插件"><a href="#idea集成Maven插件" class="headerlink" title="idea集成Maven插件"></a>idea集成Maven插件</h2><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li><p>mavenweb工程的目录</p>
<p><img src="/111zx/111zx.github.io/2020/05/20/maven/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5CMaven%5Cmaven_web.png" alt></p>
</li>
<li><p>运行Tomcat7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tomacat7:run</span><br></pre></td></tr></table></figure>
</li>
<li><p>bug,端口号重复，需要关掉一个服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">严重: Failed to initialize end point associated with ProtocolHandler [&quot;http-bio-8080&quot;]</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/maven/" data-id="ckbbzdvsc0006t8ubdaosfies" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/Git/" class="article-date">
  <time datetime="2020-05-19T23:45:49.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/Git/">Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="git-版本控制器"><a href="#git-版本控制器" class="headerlink" title="git-版本控制器"></a>git-版本控制器</h2><ul>
<li><p>改代码思路错误之后需要回滚</p>
</li>
<li><p>找出谁修改的代码导致的BUG</p>
</li>
</ul>
<h3 id="集中化的版本控制（svn）"><a href="#集中化的版本控制（svn）" class="headerlink" title="集中化的版本控制（svn）"></a>集中化的版本控制（svn）</h3><ul>
<li>服务器保存所有文件的修订版本</li>
<li>每个人都可以看到其他人的代码，管理员也可以掌控每个开发者的权限</li>
<li>存储的时每个相邻版本之间的差异，需要硬盘的空间会相对的小一点，回滚的速度会很慢</li>
<li>优点：<ul>
<li>代码存放在单一的服务器上，便于项目管理</li>
</ul>
</li>
<li>缺点：<ul>
<li>服务器宕机：员工写的代码得不到保障</li>
<li>服务器故障：整个项目历史记录都会丢失</li>
</ul>
</li>
</ul>
<h3 id="分布式版本控制（git）"><a href="#分布式版本控制（git）" class="headerlink" title="分布式版本控制（git）"></a>分布式版本控制（git）</h3><ul>
<li>客户端并不只提取最新版本的文件快照，而是把代码仓库完整镜像下来</li>
<li>客户端存的是索引，而已磁盘空间很小，每个客户端都可以放下整个项目的历史记录</li>
<li>git每次存储的都是项目的完整快照，需要按的硬盘空间会相对大一点（Git对代码进行了极致的压缩，最终的实际空间比svn多不了多少，而且git回滚速度快）</li>
</ul>
<h3 id="简史"><a href="#简史" class="headerlink" title="简史"></a>简史</h3><ul>
<li><p>linux的开发团队</p>
</li>
<li><p>之前用BitKeeper管理代码，之后关系结束，最后谢了Git </p>
</li>
</ul>
<h2 id="git初始化配置"><a href="#git初始化配置" class="headerlink" title="git初始化配置"></a>git初始化配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;111zx&quot;</span><br><span class="line">git config --global user.email &quot;111zx&quot;</span><br><span class="line">gir config list&#x2F;&#x2F;罗列配置信息</span><br></pre></td></tr></table></figure>

<h2 id="工作区-暂存区-本地库"><a href="#工作区-暂存区-本地库" class="headerlink" title="工作区 暂存区 本地库"></a>工作区 暂存区 本地库</h2><ul>
<li>工作区，修改代码的地方，git add之前的区域</li>
<li>暂存区，存放修改之后代码的地方，git add 之后的区域</li>
<li>本地库，历史版本的存放位置，git commit之后的区域</li>
</ul>
<h1 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h1><h2 id="1-从github拉项目到idea"><a href="#1-从github拉项目到idea" class="headerlink" title="1. 从github拉项目到idea"></a>1. 从github拉项目到idea</h2><h3 id="1-1-克隆github项目的https"><a href="#1-1-克隆github项目的https" class="headerlink" title="1-1 克隆github项目的https"></a>1-1 克隆github项目的https</h3><p><img src="C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5C%E5%85%8B%E9%9A%86githubhttps.png" alt="克隆githubhttps"></p>
<h3 id="1-2-创建gitee的仓库，将github上的项目先导入gitee并下载"><a href="#1-2-创建gitee的仓库，将github上的项目先导入gitee并下载" class="headerlink" title="1-2 创建gitee的仓库，将github上的项目先导入gitee并下载"></a>1-2 创建gitee的仓库，将github上的项目先导入gitee并下载</h3><ul>
<li>github下载太慢，用码云会快很多</li>
</ul>
<ol>
<li>进入码云首页，新建仓库</li>
</ol>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cgitee%E4%BB%93%E5%BA%93%E5%88%9B%E5%BB%BA1.png" alt="gitee仓库创建1"></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cgitee%E4%BB%93%E5%BA%93%E5%88%9B%E5%BB%BA2.png" alt></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cgitee%E4%BB%93%E5%BA%93%E5%88%9B%E5%BB%BA3.png" alt></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cgitee%E4%BB%93%E5%BA%93%E5%88%9B%E5%BB%BA4.png" alt></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5C%E4%B8%8B%E8%BD%BD%E9%A1%B9%E7%9B%AE.png" alt></p>
<ul>
<li>标出红色的操作即可，其他的默认。</li>
</ul>
<h3 id="1-3-解压项目包并在idea中导入下载好的项目"><a href="#1-3-解压项目包并在idea中导入下载好的项目" class="headerlink" title="1-3 解压项目包并在idea中导入下载好的项目"></a>1-3 解压项目包并在idea中导入下载好的项目</h3><ol>
<li>点击导入项目，选择解压好的文件夹</li>
</ol>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cidea%E5%AF%BC%E5%85%A5%E9%A1%B9%E7%9B%AE.png" alt></p>
<ol start="2">
<li>根据自己的项目选择模型</li>
</ol>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5C%E9%80%89%E6%8B%A9maven%E9%A1%B9%E7%9B%AE.png" alt></p>
<ol start="3">
<li>创建完成</li>
</ol>
<ul>
<li>完成之后maven项目需要自动导入jar包</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5C%E5%88%9B%E5%BB%BA%E5%AE%8C%E6%88%90.png" alt></p>
<h2 id="2-使用git对项目进行版本控制"><a href="#2-使用git对项目进行版本控制" class="headerlink" title="2. 使用git对项目进行版本控制"></a>2. 使用git对项目进行版本控制</h2><h3 id="2-1-idea相关设置"><a href="#2-1-idea相关设置" class="headerlink" title="2-1 idea相关设置"></a>2-1 idea相关设置</h3><ul>
<li>目录选择自己安装的git目录。</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CDesktop%5C%E5%9B%BE%E7%89%87%E4%B8%AD%E8%BD%AC%E7%AB%99%5Cgit%5Cidea%E8%AE%BE%E7%BD%AE.png" alt></p>
<ul>
<li>创建本地仓库</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605085702590.png" alt="image-20200605085702590"></p>
<ul>
<li>选择解压好的项目文件夹</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605085750469.png" alt="image-20200605085750469"></p>
<h3 id="2-2-使用git命令行操作"><a href="#2-2-使用git命令行操作" class="headerlink" title="2-2 使用git命令行操作"></a>2-2 使用git命令行操作</h3><ol>
<li>进入项目文件夹</li>
</ol>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605090219976.png" alt="image-20200605090219976"></p>
<ol start="2">
<li>查看本地仓库的状态</li>
</ol>
<ul>
<li><strong>红色的表示没有提交，不在暂存区</strong></li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605090336964.png" alt="image-20200605090336964"></p>
<ul>
<li><strong>绿色表示已经提交到暂存区</strong></li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605110411146.png" alt="image-20200605110411146"></p>
<h3 id="2-2-1-把不需要提交的文件从暂存区删除"><a href="#2-2-1-把不需要提交的文件从暂存区删除" class="headerlink" title="2-2-1 把不需要提交的文件从暂存区删除"></a>2-2-1 把不需要提交的文件从暂存区删除</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached &lt;file&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-把暂存区的数据提交到本地库"><a href="#2-2-2-把暂存区的数据提交到本地库" class="headerlink" title="2-2-2 把暂存区的数据提交到本地库"></a>2-2-2 把暂存区的数据提交到本地库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit &#x2F;&#x2F;必须要有提交信息，是个注释，表明这次提交的意图。</span><br></pre></td></tr></table></figure>

<ul>
<li>提交之后暂存区将没有数据</li>
<li>一般使用如下格式提交</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"change"</span> &lt;file&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-git-commit-a"><a href="#2-2-3-git-commit-a" class="headerlink" title="2-2-3 git commit -a"></a>2-2-3 git commit -a</h3><ul>
<li>直接追踪并且提交</li>
<li>新建的文件不能直接提交，需要先添加到缓存区</li>
<li><strong>已经存在的文件不添加到缓存区直接提交的话不能撤回。</strong></li>
</ul>
<h3 id="2-2-4-git-log"><a href="#2-2-4-git-log" class="headerlink" title="2-2-4 git log"></a>2-2-4 git log</h3><p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605112646113.png" alt="image-20200605112646113"></p>
<h3 id="2-2-5-git-log-–pretty-oneline"><a href="#2-2-5-git-log-–pretty-oneline" class="headerlink" title="2-2-5 git log –pretty=oneline"></a>2-2-5 git log –pretty=oneline</h3><p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605113153618.png" alt="image-20200605113153618"></p>
<h3 id="2-2-6-git-log-–online"><a href="#2-2-6-git-log-–online" class="headerlink" title="2-2-6 git log –online"></a>2-2-6 git log –online</h3><p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605113852407.png" alt="image-20200605113852407"></p>
<h3 id="2-2-7-git-reflog"><a href="#2-2-7-git-reflog" class="headerlink" title="2-2-7 git reflog"></a>2-2-7 git reflog</h3><ul>
<li>到某一个版本需要移动几步</li>
<li>基于head指针</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605114018809.png" alt="image-20200605114018809"></p>
<h2 id="3-基于索引值的版本操作"><a href="#3-基于索引值的版本操作" class="headerlink" title="3. 基于索引值的版本操作"></a>3. 基于索引值的版本操作</h2><h3 id="3-1-git-reset-–hard-d492089"><a href="#3-1-git-reset-–hard-d492089" class="headerlink" title="3-1 git reset –hard d492089"></a>3-1 git reset –hard d492089</h3><ul>
<li>回退到d492089版本<img src="/111zx/111zx.github.io/2020/05/20/Git/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200605114727819.png" alt="image-20200605114727819"></li>
</ul>
<h3 id="3-2-reset三个参数对比"><a href="#3-2-reset三个参数对比" class="headerlink" title="3-2 reset三个参数对比"></a>3-2 reset三个参数对比</h3><h4 id="soft"><a href="#soft" class="headerlink" title="soft"></a>soft</h4><ul>
<li>在本地库移动head指针</li>
</ul>
<h4 id="mixed"><a href="#mixed" class="headerlink" title="mixed"></a>mixed</h4><ul>
<li>在本地库移动head指针</li>
<li>重置暂存区</li>
</ul>
<p>hard</p>
<ul>
<li>在本地库移动head指针</li>
<li>重置暂存区</li>
<li>重置工作区</li>
</ul>
<h2 id="提交到本地库后删除文件"><a href="#提交到本地库后删除文件" class="headerlink" title="提交到本地库后删除文件"></a>提交到本地库后删除文件</h2><p>- </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/Git/" data-id="ckbbzdvs60003t8ubhduu5cgk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/Mysql/" class="article-date">
  <time datetime="2020-05-19T23:45:39.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/Mysql/">Mysql</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="第一章-概述"><a href="#第一章-概述" class="headerlink" title="第一章 概述"></a>第一章 概述</h1><h2 id="为什么要学习数据库"><a href="#为什么要学习数据库" class="headerlink" title="为什么要学习数据库"></a>为什么要学习数据库</h2><h3 id="其他的保存数据方式"><a href="#其他的保存数据方式" class="headerlink" title="其他的保存数据方式"></a>其他的保存数据方式</h3><ul>
<li>数组，集合：在内存中，断电就没了</li>
<li>文件：不适合查询</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>实现数据持久化</li>
<li>有完整的管理系统，易于查询</li>
</ul>
<h2 id="数据库的概念"><a href="#数据库的概念" class="headerlink" title="数据库的概念"></a>数据库的概念</h2><h3 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h3><ul>
<li>存储数据的“仓库”。保存了一系列有组织的数据。</li>
</ul>
<h3 id="DBMS"><a href="#DBMS" class="headerlink" title="DBMS"></a>DBMS</h3><ul>
<li>数据库管理系统，管理DB中的数据。例如MySQL,Oracle,DB2,SqlServer等</li>
</ul>
<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><ul>
<li>数据库查询语言，和DBMS通信的语言。</li>
</ul>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ol>
<li>不是某个特定DBMS专有的语言，几乎适用于所有SQL</li>
<li>简单易学</li>
<li>功能强大</li>
</ol>
<h2 id="MySql的产品特点"><a href="#MySql的产品特点" class="headerlink" title="MySql的产品特点"></a>MySql的产品特点</h2><ol>
<li>成本低；开放源代码，一般可以免费</li>
<li>性能高：执行速度快</li>
<li>简单：容易安装和使用</li>
</ol>
<h3 id="DBMS分为两类"><a href="#DBMS分为两类" class="headerlink" title="DBMS分为两类"></a>DBMS分为两类</h3><ul>
<li>基于共享文件系统的DBMS（Access）</li>
<li>基于客户机—服务器的DBMS（Mysql）</li>
</ul>
<h3 id="Mysql的卸载"><a href="#Mysql的卸载" class="headerlink" title="Mysql的卸载"></a>Mysql的卸载</h3><ol>
<li>普通卸载结束</li>
<li>清理注册表</li>
</ol>
<h3 id="配置文件介绍"><a href="#配置文件介绍" class="headerlink" title="配置文件介绍"></a>配置文件介绍</h3><ul>
<li><p>my.ini</p>
<ul>
<li><p>更改后需要重新启动</p>
</li>
<li><pre><code>
[mysqld]

# 设置3306端口

port=3306

# 设置mysql的安装目录

basedir=C:\Program Files\MySQL

# 设置mysql数据库的数据的存放目录

datadir=C:\Program Files\MySQL\Data

# 允许最大连接数

max_connections=200

# 允许连接失败的次数。

max_connect_errors=10

# 服务端使用的字符集默认为utf8mb4

character-set-server=utf8mb4

# 创建新表时将使用的默认存储引擎

default-storage-engine=INNODB

# 默认使用“mysql_native_password”插件认证

#mysql_native_password

default_authentication_plugin=mysql_native_password

[mysql]

# 设置mysql客户端默认字符集

default-character-set=utf8mb4

[client]

# 设置mysql客户端连接服务端时默认使用的端口

port=3306

default-character-set=utf8mb4

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## Mysql服务启动和停止</span><br><span class="line"></span><br><span class="line">1. 计算机管理 —&gt;服务和应用程序 —&gt;服务—&gt;MySQL</span><br><span class="line"></span><br><span class="line">2. 管理员命令行操作</span><br></pre></td></tr></table></figure>
右击开始 windows powershell

net stop mysql 
net start mysql
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## MySQL服务端的登录和退出</span><br><span class="line"></span><br><span class="line">- 方式一：mysql自带的客户端：只限于root用户</span><br><span class="line"></span><br><span class="line">- 通过Windows自带的客户端</span><br><span class="line"></span><br><span class="line">  - 在管理员shell输入</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96;java</span><br><span class="line">  mysql -h localhost -P 3306 -u root -p</span><br></pre></td></tr></table></figure></code></pre></li>
<li><p>退出</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="MySQL常见命令"><a href="#MySQL常见命令" class="headerlink" title="MySQL常见命令"></a>MySQL常见命令</h2><ul>
<li><p>显示所有数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use lmonkeyshop;<span class="comment">//表名字lmonkeyshop</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看现在的数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">database</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看表的结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc stuinfo;<span class="comment">//stuinfo 表名字</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>插入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">insert into <span class="title">stuinfo</span> <span class="params">(id,name)</span> <span class="title">values</span><span class="params">(<span class="number">1</span>,<span class="string">'john'</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update stuinfo set name = <span class="string">'leilei'</span> where id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看数据库版本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">version</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="语法规范"><a href="#语法规范" class="headerlink" title="语法规范"></a>语法规范</h3><ol>
<li><p>大小写不区分，建议关键字大写，表名，列名小写</p>
</li>
<li><p>每条命令用分号结尾</p>
</li>
<li><p>缩进</p>
</li>
<li><p>注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单行注释</span></span><br><span class="line"># 注释文字</span><br><span class="line">-- 注释文字</span><br><span class="line"><span class="comment">/* 注释文字 */</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h1 id="第二章-DQL的学习"><a href="#第二章-DQL的学习" class="headerlink" title="第二章 DQL的学习"></a>第二章 DQL的学习</h1><h2 id="2-1-基础查询器"><a href="#2-1-基础查询器" class="headerlink" title="2-1 基础查询器"></a>2-1 基础查询器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询列表：表中的字段，常量值，表达式和函数</span></span><br><span class="line"><span class="keyword">USE</span> myemployees;</span><br><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询一个字段</span></span><br><span class="line"><span class="keyword">USE</span> myemployees；</span><br><span class="line"><span class="keyword">select</span> <span class="string">`last_name`</span>				<span class="comment">--在字段和关键字重复时用`` </span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询所有字段</span></span><br><span class="line"><span class="keyword">USE</span> myemployees;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    *</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	employees</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询常量值</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">'john'</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询表达式</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span> % <span class="number">98</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询函数</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 起别名</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">100</span> % <span class="number">98</span> <span class="keyword">AS</span> 结果;</span><br><span class="line"><span class="keyword">select</span> last_name <span class="keyword">AS</span> 姓,first_name <span class="keyword">AS</span> 名 <span class="keyword">from</span> employees;</span><br><span class="line"><span class="keyword">select</span> last_name 姓,first_name 名 <span class="keyword">from</span> employees;</span><br><span class="line"><span class="comment">-- 别名和关键字冲突用双引号</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> <span class="string">"OUT PUT"</span> <span class="keyword">from</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> <span class="keyword">OUT</span> PUT <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 去重</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- +号作用：只有一个功能，数学意义的加号</span></span><br><span class="line"><span class="comment">-- select '123'+90;会将'123'转换成123，转换成功直接运算；转换失败，变成0+99</span></span><br><span class="line"><span class="comment">-- select null + 90;只要有一方为null，所有都是null</span></span><br><span class="line"><span class="comment">-- 查询员工姓和名合成一个字段</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name+first_name <span class="keyword">AS</span> 姓名 <span class="keyword">FROM</span> employees; <span class="comment">--错误的使用方法</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 拼接 只要有一个是NULL，最终结果都是NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="string">'C'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>) <span class="keyword">AS</span> 结果;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span>  <span class="keyword">CONCAT</span>(first_name,last_name,<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) <span class="keyword">AS</span> <span class="string">"OUT PUT"</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>) <span class="keyword">AS</span> 奖金率 <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-条件查询"><a href="#2-2-条件查询" class="headerlink" title="2-2 条件查询"></a>2-2 条件查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table1 <span class="keyword">where</span> 条件</span><br></pre></td></tr></table></figure>

<ul>
<li><p>条件运算符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- &lt; = &gt; &lt;&gt; &lt;= &gt;= (!=也可以用，但是不推荐)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资大于1000块的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary &gt; <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询部门编号不等于90号的员工名和部门编号</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id &lt;&gt; <span class="number">90</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>逻辑运算符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- and  or  not 用于连接条件表达式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资 10000~20000</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary,commission_pct <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&gt;=<span class="number">10000</span> <span class="keyword">AND</span> salary&lt;=<span class="number">20000</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 部门编号不在90到110，或者工资高于15000的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id&lt;<span class="number">90</span> <span class="keyword">AND</span> department_id&gt;<span class="number">110</span> <span class="keyword">OR</span> salary&gt;<span class="number">15000</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>模糊查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">like </span></span><br><span class="line"><span class="comment">特点：一般和通配符搭配使用</span></span><br><span class="line"><span class="comment">% 任意多个字符</span></span><br><span class="line"><span class="comment">_ 任意单个字符</span></span><br><span class="line"><span class="comment">between and </span></span><br><span class="line"><span class="comment">in </span></span><br><span class="line"><span class="comment">is null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工名包含字符a的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%a%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询员工名第三个字符为n，第五个字符为l的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'___n_l%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工名中第二个字符为下划线的员工信息,通过转义字符\，或者自定义转移字符</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'_\_%'</span>;</span><br><span class="line"><span class="comment">-- WHERE last_name LIKE '_$_%' ESCAPE '$';</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- between and</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">注意事项：</span></span><br><span class="line"><span class="comment">1.可以提高代码简介度</span></span><br><span class="line"><span class="comment">2.包含临界值</span></span><br><span class="line"><span class="comment">3.100和200不能颠倒</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">--查询员工编号在100-120之间的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">120</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- in 用来判断是否属于列表中的某一项</span></span><br><span class="line"><span class="comment">-- 1. 提高了语句的简洁性</span></span><br><span class="line"><span class="comment">-- 2. 列表的值类型必须要兼容</span></span><br><span class="line"><span class="comment">-- 3. 不可以用%等符号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工工种编号是 IT_PROG,AD_VP,AD_PRES中的一个的员工信息</span></span><br><span class="line">  <span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> job_id <span class="keyword">IN</span> (<span class="string">'ID_PROG'</span>,<span class="string">'AD_VP'</span>,<span class="string">'AD_PRES'</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- is NULL</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">= 或者 &lt;&gt; 不能判断NULL值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- 查询没有奖金的员工名和奖金率</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">is</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询有奖金的员工名和奖金率</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">is</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- &lt;=&gt; 安全等于</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">可以查询NULL和普通类型</span></span><br><span class="line"><span class="comment">可读性差</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- 查询没有奖金的员工名和奖金率</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct &lt;=&gt;<span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>排序查询</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TABLE</span> </span><br><span class="line"><span class="keyword">WHERE</span> 条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;<span class="comment">--从高到低</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TABLE</span> </span><br><span class="line"><span class="keyword">WHERE</span> 条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;<span class="comment">--从低到高  不加ASC，默认也是从低到高</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询部门编号&gt;=90的员工信息，按入职时间先后进行排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id&gt;=<span class="number">90</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hiredate <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按年薪的高低显示员工的信息(按表达式排序)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct)) <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按年薪的高低显示员工的信息(别名排序)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按员工姓名的长度排序(按函数排序)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(last_name) 字节长度，last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">LENGTH</span>(last_name) <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工信息，先按工资升序排序，再按员工编号降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>，employee_id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-常见函数"><a href="#2-3-常见函数" class="headerlink" title="2-3 常见函数"></a>2-3 常见函数</h2><ul>
<li>分类<ul>
<li>单行函数：concat ,length,ifnull等</li>
<li>分组函数<ul>
<li>功能：做统计使用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h3><h4 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h4><h4 id="length"><a href="#length" class="headerlink" title="length"></a>length</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- length</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'JOIN'</span>);<span class="comment">-- 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'张三丰hahaha'</span>);<span class="comment">-- 9 utf-8汉字三个子节</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%char%'</span>;<span class="comment">-- 查询字符集</span></span><br></pre></td></tr></table></figure>

<h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(last_time,<span class="string">'_'</span>,first_name) 姓名</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<h4 id="upper-lower"><a href="#upper-lower" class="headerlink" title="upper lower"></a>upper lower</h4>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 大小写</span></span><br><span class="line"><span class="comment">-- 姓大写，名小写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">UPPER</span>(last_time),<span class="string">'_'</span>,<span class="keyword">LOWER</span>(first_name) 姓名</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="substr-substring"><a href="#substr-substring" class="headerlink" title="substr substring"></a>substr substring</h4><ul>
<li><strong>sql语句索引从1开始</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">'李莫愁爱上了陆展元'</span>,<span class="number">7</span>) out_put;<span class="comment">-- 陆展元</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1 是开始的下标， 3 是总共的长度</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">'李莫愁爱上了陆展元'</span>,<span class="number">1</span>,<span class="number">3</span>) out_put;<span class="comment">-- 李莫愁</span></span><br></pre></td></tr></table></figure>

<h4 id="instr"><a href="#instr" class="headerlink" title="instr"></a>instr</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--返回子串的起始(第一次)索引，没有的话返回0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSTR</span>(<span class="string">'杨不悔爱上了殷六侠'</span>,<span class="string">'殷六侠'</span>) out_put <span class="keyword">WHERE</span> employees;<span class="comment">-- 7</span></span><br></pre></td></tr></table></figure>

<h4 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 去空格</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="keyword">TRIM</span>(<span class="string">'   张翠山   '</span>)) out_put; <span class="comment">-- 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 去指定字符'a'</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="keyword">TRIM</span>(<span class="string">'a'</span> <span class="keyword">FROM</span> <span class="string">'aaaaaaaa张aaa翠山aaaaaaaaaaa'</span>)) out_put; <span class="comment">-- 15</span></span><br></pre></td></tr></table></figure>

<h4 id="lpad"><a href="#lpad" class="headerlink" title="lpad"></a>lpad</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用指定的字符填充指定长度，若本来就大于指定长度，则取前指定长度的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="string">'殷素素'</span>,<span class="number">2</span>,<span class="string">'*'</span>) out_put;</span><br></pre></td></tr></table></figure>

<h4 id="rpad"><a href="#rpad" class="headerlink" title="rpad"></a>rpad</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用指定的字符右填充指定长度，若本来就大于指定长度，则取前指定长度的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">'殷素素'</span>,<span class="number">12</span>,<span class="string">'*'</span>) out_put;</span><br></pre></td></tr></table></figure>

<h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 全部替换指定字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="string">'张无忌爱上了周芷若'</span>,<span class="string">'周芷若'</span>,<span class="string">'赵敏'</span>) out_put;</span><br></pre></td></tr></table></figure>

<h4 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h4><h4 id="round"><a href="#round" class="headerlink" title="round"></a>round</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 四舍五入</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.65</span>); <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.45</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">-1.65</span>); <span class="comment">-- -2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">-1.45</span>); <span class="comment">-- -1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--小数点后保留2位</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.567</span>,<span class="number">2</span>); <span class="comment">-- 1.57</span></span><br></pre></td></tr></table></figure>

<h4 id="ceil"><a href="#ceil" class="headerlink" title="ceil"></a>ceil</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--返回大于等于该参数的最小整数，向上取整</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.002</span>); <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.000</span>); <span class="comment">-- 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">-1.002</span>); <span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.000</span>); <span class="comment">-- -1</span></span><br></pre></td></tr></table></figure>

<h4 id="floor"><a href="#floor" class="headerlink" title="floor"></a>floor</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 向下取整，返回小于等于该参数的最大整数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">-9.99</span>) <span class="comment">-- 10</span></span><br></pre></td></tr></table></figure>

<h4 id="truncate"><a href="#truncate" class="headerlink" title="truncate"></a>truncate</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 截断</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.65</span>,<span class="number">1</span>); <span class="comment">-- 1.6 小数点后保留1位</span></span><br></pre></td></tr></table></figure>

<h4 id="mod"><a href="#mod" class="headerlink" title="mod"></a>mod</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 取余</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在java中：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">MOD(a,b): a - a / b * b</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">MOD(10,3): 10 - 10 / 3 * 3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MOD</span>(<span class="number">10</span>,<span class="number">-3</span>); <span class="comment">--</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">10</span>%<span class="number">3</span>; <span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><h4 id="now"><a href="#now" class="headerlink" title="now"></a>now</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回当前日期+时间</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>();</span><br></pre></td></tr></table></figure>

<h4 id="crudate"><a href="#crudate" class="headerlink" title="crudate"></a>crudate</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回当前的系统日期，不包含时间</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURDATE</span>();</span><br></pre></td></tr></table></figure>

<h4 id="crutime"><a href="#crutime" class="headerlink" title="crutime"></a>crutime</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 返回当前的系统时间，不包含日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURTIME</span>();</span><br></pre></td></tr></table></figure>

<h4 id="YEAR"><a href="#YEAR" class="headerlink" title="YEAR"></a>YEAR</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 可以获取指定的部分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) 年;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="keyword">NOW</span>()) 月;</span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(<span class="keyword">NOW</span>()) 月;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAY HOUR MINUTE SECOND</span></span><br></pre></td></tr></table></figure>

<h4 id="str-to-date"><a href="#str-to-date" class="headerlink" title="str_to_date"></a>str_to_date</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将日期格式的字符转换成指定格式的日期</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">STR_TO_DATE</span>(<span class="string">'9-13-1999'</span>,<span class="string">'%m-%d-%Y'</span>); <span class="comment">-- 1999-09-13</span></span><br></pre></td></tr></table></figure>

<p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200607112952093.png" alt="image-20200607112952093"></p>
<h4 id="date-format"><a href="#date-format" class="headerlink" title="date_format"></a>date_format</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--将日期转成字符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(),<span class="string">'%y年%m月%d日'</span>) <span class="keyword">AS</span> out_put;</span><br></pre></td></tr></table></figure>

<h4 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">VERSION</span>(); <span class="comment">-- 当前版本</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();<span class="comment">-- 当前数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>(); <span class="comment">-- 当前用户</span></span><br></pre></td></tr></table></figure>

<h4 id="流程控制函数"><a href="#流程控制函数" class="headerlink" title="流程控制函数"></a>流程控制函数</h4><ul>
<li>类似if else函数，三元运算符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">10</span>&gt;<span class="number">5</span>,<span class="string">'大'</span>，<span class="string">'小'</span>) 举例;</span><br></pre></td></tr></table></figure>

<ul>
<li>case函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用一：类似于switch case</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">case 需要判断的字段或者表达式</span></span><br><span class="line"><span class="comment">when 常量1 then 要显示的值1或者语句1;</span></span><br><span class="line"><span class="comment">when 常量2 then 要显示的值2或者语句2;</span></span><br><span class="line"><span class="comment">when 常量3 then 要显示的值3或者语句3;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">else 要显示的值n或者语句n;</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工的工资</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果部门号=30，显示工资的1.1倍</span></span><br><span class="line"><span class="comment">如果部门号=40，显示工资的1.2倍</span></span><br><span class="line"><span class="comment">如果部门号=50，显示工资的1.3倍</span></span><br><span class="line"><span class="comment">其他，显示工资的1倍</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> salary 原始工资,department_id,</span><br><span class="line"></span><br><span class="line"><span class="keyword">CASE</span> department_id</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary*<span class="number">1.1</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">40</span> <span class="keyword">THEN</span> salary*<span class="number">1.2</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> salary*<span class="number">1.3</span></span><br><span class="line"><span class="keyword">ELSE</span> salary</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 新工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用二 类似于多重if</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">case </span></span><br><span class="line"><span class="comment">when 条件 then 要显示的值1或语句1（语句要加;）</span></span><br><span class="line"><span class="comment">when 条件 then 要显示的值2或语句2（语句要加;）</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">else 要显示的值n或语句n（语句要加;）</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工的工资情况</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果工资大于2w 显示A级别</span></span><br><span class="line"><span class="comment">如果工资大于1.5w 显示B级别</span></span><br><span class="line"><span class="comment">如果工资大于1w 显示C级别</span></span><br><span class="line"><span class="comment">其他，显示D级别</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> salary,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">20000</span> <span class="keyword">THEN</span><span class="string">'A'</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">20000</span> <span class="keyword">THEN</span><span class="string">'B'</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">20000</span> <span class="keyword">THEN</span><span class="string">'C'</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">'D'</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 工资级别;</span><br></pre></td></tr></table></figure>

<h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><ul>
<li>主要用作统计使用</li>
<li>分类<ul>
<li>sum</li>
<li>avg</li>
<li>max</li>
<li>min</li>
<li>count</li>
</ul>
</li>
</ul>
<h4 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求和</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数不可以是字符型，日期型，不报错，但是没有任何逻辑意义</span></span><br><span class="line"><span class="comment">null不参与运算，任何数和null+运算是null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 691400.00</span></span><br></pre></td></tr></table></figure>

<h4 id="avg"><a href="#avg" class="headerlink" title="avg"></a>avg</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求平均值</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数不可以是字符型，日期型，不报错，但是没有任何逻辑意义</span></span><br><span class="line"><span class="comment">null不参与运算，任何数和null+运算是null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 5200.654</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 和其他函数配合使用 round</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">AVG</span>(salary),<span class="number">2</span>) <span class="keyword">FROM</span> employees; <span class="comment">-- 5200.65</span></span><br></pre></td></tr></table></figure>

<h4 id="min"><a href="#min" class="headerlink" title="min"></a>min</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求最小值</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数可以是字符型，日期型</span></span><br><span class="line"><span class="comment">忽略null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 1000</span></span><br></pre></td></tr></table></figure>

<h4 id="max"><a href="#max" class="headerlink" title="max"></a>max</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求最大值</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数可以是字符型，日期型</span></span><br><span class="line"><span class="comment">忽略null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 20000</span></span><br></pre></td></tr></table></figure>

<h4 id="count"><a href="#count" class="headerlink" title="count"></a>count</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 求非空值</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数可以是字符型，日期型，计算的是非空值的name</span></span><br><span class="line"><span class="comment">忽略null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 5</span></span><br></pre></td></tr></table></figure>

<h4 id="和distinct搭配使用"><a href="#和distinct搭配使用" class="headerlink" title="和distinct搭配使用"></a>和distinct搭配使用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(<span class="keyword">DISTINCT</span> salaty) <span class="keyword">FROM</span> employees;<span class="comment">-- 去重后求和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> salaty) <span class="keyword">FROM</span> employees;<span class="comment">-- 去重后计数</span></span><br></pre></td></tr></table></figure>

<h4 id="count函数详细介绍"><a href="#count函数详细介绍" class="headerlink" title="count函数详细介绍"></a>count函数详细介绍</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 统计行数，只要有一个字段不为null就+1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计1的个数，也是行数，1是一个常量值，任何常量值都可</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>效率问题：<ul>
<li>MYUSAM存储引擎下，COUNT(*)效率高，有自带的计数功能:</li>
<li>INNODB存储引擎下，COUNT(1)效率和COUNT(*)一样高，统计行数。</li>
</ul>
</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工表中最大入职时间和最小入职时间的相差天数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="keyword">MAX</span>(hiredate),<span class="keyword">MIN</span>(hiredate)) DIFFRENCE</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 分组函数,列（要求出现在<span class="keyword">group</span> <span class="keyword">by</span>后面）</span><br><span class="line"><span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组的列表</span><br></pre></td></tr></table></figure>

<ul>
<li>案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个工种的最高工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary)，job_id</span><br><span class="line"><span class="keyword">FROM</span> employess</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个位置上的部门个数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),location_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  location_id;</span><br></pre></td></tr></table></figure>

<ul>
<li>具有筛选条件的案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询邮箱中包含a字符的，每个部门的平均工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">like</span> <span class="string">'%a%'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询有奖金的每个领导手下员工的最高工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary),manager_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commision_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id</span><br></pre></td></tr></table></figure>

<ul>
<li>负责的筛选条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询哪个部门的员工个数 &gt; 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个工种有奖金的员工的最高工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary)，job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">is</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MAX</span>(salary)&gt;<span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询领导编号&gt;102的领导手下的最低工资&gt;5000的领导编号是哪个，以及其最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary),manager_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id&gt;<span class="number">102</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MIN</span>(salary)&gt;<span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><ul>
<li><p>HAVING 是在分组后做的操作，GROUP BY 是在分组前做的操作</p>
</li>
<li><p>分组前筛选的性能会好很多</p>
</li>
<li><p>按表达式分组</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工个数&gt;5个内容</span></span><br><span class="line"><span class="comment">-- MYSQL支持别名使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),<span class="keyword">LENGTH</span>(last_name) len_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">LENGTH</span>(last_name)</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">5</span></span><br></pre></td></tr></table></figure>

<ul>
<li>按多个字段分组</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个工种每个部门的员工的平均工资&gt;10000，并且按平均工资的高低显示</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),department_id,job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id,job_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">AVG</span>(salary)&gt;<span class="number">10000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><h3 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无条件筛选</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>,boyName <span class="keyword">FROM</span> beauty,boys;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有条件筛选</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>，boyName <span class="keyword">FROM</span> beauty，boys</span><br><span class="line"><span class="keyword">WHERE</span> beauty.boyfriend_id=boys.id;</span><br></pre></td></tr></table></figure>

<h3 id="连接查询的分类"><a href="#连接查询的分类" class="headerlink" title="连接查询的分类"></a>连接查询的分类</h3><ul>
<li>按年代分类 <ul>
<li>sql92标准 仅支持内连接</li>
<li>sql99标准 支持内连接 外连接和全外连接</li>
</ul>
</li>
<li>按功能分类<ul>
<li>内连接<ul>
<li>等值连接</li>
<li>非等值连接</li>
<li>自连接</li>
</ul>
</li>
<li>外连接<ul>
<li>左外连接</li>
<li>右外连接</li>
<li>全外连接</li>
</ul>
</li>
<li>交叉连接</li>
</ul>
</li>
</ul>
<h3 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工名和对应的部门名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees,departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.<span class="string">`department_id`</span>=departments.<span class="string">`department_id`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工名，工种名，工种号</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,job_id,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees,jobs</span><br><span class="line"><span class="keyword">WHERE</span> employees.<span class="string">`job_id`</span>=jobs.<span class="string">`job_id`</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>如果为表起了别名，查询的字段不能用原来的表名去限定</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询有奖金的员工名，部门名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,commission_pct</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`commission_pct`</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询城市名中第二个字符为o的部门名和城市名</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name,city</span><br><span class="line"><span class="keyword">FROM</span> departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`location_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> city <span class="keyword">LIKE</span><span class="string">'_o%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个城市的部门个数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) 个数,city</span><br><span class="line"><span class="keyword">FROM</span> departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询有奖金的每个部门名和部门的领导编号和该部门的最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name,d.manager_id,<span class="keyword">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> departments d,employees e</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name,d.manager_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每个工种的工种名和员工的个数，并且按员工个数降序</span></span><br><span class="line"><span class="keyword">SELECT</span> job_title,<span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> employees e,jobs j</span><br><span class="line"><span class="keyword">WHERE</span> j.<span class="string">`job_id`</span>=e.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_title</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>实现多表连接</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工名，部门名和所在的城市</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,city</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d,loactions l</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>多表等值连接的结果为多表的交集</li>
<li>n表连接，至少需要n-1个连接条件</li>
<li>一般需要为表起别名</li>
<li>可以搭配排序，分组，筛选使用</li>
</ul>
<h3 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的工资和工资界别</span></span><br><span class="line"><span class="keyword">SELECT</span> salary,grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e,job_grades g</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工名和上级的名称</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id,e.last_name,m.employee_id,m.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e,employees m</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`manager_id`</span> = m.<span class="string">`employee_id`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="sql99"><a href="#sql99" class="headerlink" title="sql99"></a>sql99</h3><ul>
<li><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表<span class="number">1</span> 别名 连接类型</span><br><span class="line"><span class="keyword">join</span> 表<span class="number">2</span> 别名</span><br><span class="line"><span class="keyword">on</span> 连接条件</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">having</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><ul>
<li>inner</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--inner可以省略</span></span><br><span class="line"><span class="comment">--筛选条件放在where后，连接条件放在ON后</span></span><br><span class="line"><span class="comment">--都是查询交集部分，和92语法的等值连接效果和原理一样</span></span><br><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表<span class="number">1</span> 别名</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> 表<span class="number">2</span> 别名</span><br><span class="line"><span class="keyword">on</span> 连接条件</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工名，部门名</span></span><br><span class="line"><span class="comment">-- 和92语法原理完全一样</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`department_id`</span> = d.<span class="string">`department_id`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询名字中包含e的员工名和工种名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`job_id`</span> = j.<span class="string">'job_id'</span></span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`last_name`</span><span class="keyword">LIKE</span><span class="string">'%e%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询部门个数&gt;3的城市名和部门个数</span></span><br><span class="line"><span class="keyword">SELECT</span> city，<span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询哪个部门的员工个数&gt;3的部门名和员工个数，并按个数降序</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name <span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`department_id`</span> = d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工名，部门名，工种名，并按部门名排序</span></span><br><span class="line"><span class="comment">-- 先执行第一个筛选条件形成一个大表，再和下一个表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_name <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 非等值连接</span></span><br><span class="line"><span class="comment">-- 查询工资级别 &gt; 2的个数，并且按工资级别降序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> grade_level</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">20</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 自连接</span></span><br><span class="line"><span class="comment">-- 查询名字中包含字符k员工的名字，上级的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> e.last_name,m.lastname</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m </span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`manager_id`</span>=m.<span class="string">`employee_id`</span>;</span><br><span class="line">WHERE e.`last_name` LIKE '%k%';</span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><ul>
<li><p>一般来用来查询一个表中有而另一个表中没有</p>
</li>
<li><p>外连接的查询为主表中的所有记录</p>
<ul>
<li>如果从表中有和它匹配的，则显示匹配的值</li>
<li>如果从表中没有和它匹配的，则显示null</li>
<li>外连接查询结果为内连接结果以及主表中有从表中没有的记录</li>
</ul>
</li>
<li><p>left 【outer】</p>
<ul>
<li>left join左边是主表</li>
</ul>
</li>
<li><p>right 【out】</p>
<ul>
<li>right join 右边是主表</li>
</ul>
</li>
<li><p>full 【outer】</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询男朋友不再男生表的女生名</span></span><br><span class="line"><span class="keyword">SELECT</span> b.name</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span> = bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--效果和上面相同</span></span><br><span class="line"><span class="keyword">SELECT</span> b.name</span><br><span class="line"><span class="keyword">FROM</span> boys bo</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> beauty b</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span> = bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--全外连接 不支持</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h4><ul>
<li>cross</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 笛卡尔乘积 结果为n*m行</span></span><br><span class="line"><span class="keyword">SELECT</span> b.*,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> boys bo;</span><br></pre></td></tr></table></figure>

<h4 id="sql99和sql92对比"><a href="#sql99和sql92对比" class="headerlink" title="sql99和sql92对比"></a>sql99和sql92对比</h4><ul>
<li>功能sql99更强大</li>
<li>sql99可读性高</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200711093652691.png" alt="image-20200711093652691"></p>
<p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200711093812666.png" alt="image-20200711093812666"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询编号&gt;3的女生的男朋友信息，如果有，列出详细信息；如果没有，用null填充</span></span><br><span class="line"><span class="keyword">SELECT</span> b.id,b.name,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> b.<span class="string">`id`</span>&gt;<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询那个城市没有部门</span></span><br><span class="line"><span class="keyword">SELECT</span> city</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询部门名为SAL或者IT的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> e.*,department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_name`</span> <span class="keyword">IN</span>(<span class="string">'SAL'</span>,<span class="string">'IT'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><ul>
<li>出现在其他语句内部的select语句，称为子查询</li>
<li>可以出现的位置<ul>
<li>select后<ul>
<li>仅支持标量子查询（结果集只有一行一列）</li>
</ul>
</li>
<li>from后<ul>
<li>支持表子查询（结果集一般为多行多列）</li>
</ul>
</li>
<li><strong>where</strong><ul>
<li><strong>标量子查询</strong></li>
<li><strong>列子查询（一列多行）</strong></li>
<li><strong>行子查询（一行多列）</strong></li>
</ul>
</li>
<li><strong>having</strong><ul>
<li><strong>标量子查询</strong></li>
<li><strong>列子查询</strong></li>
<li><strong>行子查询</strong></li>
</ul>
</li>
<li>exists<ul>
<li>表子查询</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="WHERE-或者-HAVING"><a href="#WHERE-或者-HAVING" class="headerlink" title="WHERE 或者 HAVING"></a>WHERE 或者 HAVING</h3><ul>
<li>特点<ul>
<li>子查询放在小括号内</li>
<li>子查询一般放在条件的右侧</li>
<li>标量子查询，一般搭配着单行操作符使用</li>
</ul>
</li>
<li>什么时候用WHERE，什么时候用HAVING<ul>
<li>having一般是判断集合</li>
</ul>
</li>
</ul>
<h4 id="案例-标量子查询"><a href="#案例-标量子查询" class="headerlink" title="案例 - 标量子查询"></a>案例 - 标量子查询</h4><ul>
<li><strong>一般搭配着单行操作符使用</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单行操作符 &gt; &lt; &gt;= &lt;= &lt;&gt;</span></span><br><span class="line"><span class="comment">-- 查询工资比Abel高的人</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&gt;(</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name = <span class="string">'Abel'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回job_id与141号员工相同，salary比143号员工多的员工的姓名，job_id和工资</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> job_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> employee_id = <span class="number">141</span></span><br><span class="line">) <span class="keyword">AND</span> salary &gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> employee_id = <span class="number">141</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回工资最少的员工的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询最低工资大于50号部门最低工资的部门id和其最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="keyword">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MIN</span>(salary) &gt; (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> department_id = <span class="number">50</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="案例-列子查询"><a href="#案例-列子查询" class="headerlink" title="案例 - 列子查询"></a>案例 - 列子查询</h4><ul>
<li>多行操作符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN/ NOT IN    ANY/SOME    ALL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回location_id 是1400或者1700的部门中的所有员工姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> departments</span><br><span class="line">    <span class="keyword">WHERE</span> location_id <span class="keyword">IN</span>(<span class="number">1400</span>,<span class="number">1700</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回其他部门中比job_id为`IT_PROG`部门任一工资低的员工的员工姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary &gt; <span class="keyword">ANY</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br><span class="line">)<span class="keyword">AND</span> job_id &lt;&gt; <span class="string">'IT_PROG'</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>注意：</p>
<p>判断大于的情况下：</p>
<ul>
<li>ALL()和子查询中换成MAX()效果相同</li>
<li>ANY()和子查询中换成MIN()效果相同</li>
</ul>
<p>在判断小于情况下</p>
<ul>
<li>ANY()和子查询中换成MAX()效果相同</li>
<li>ALL()和子查询中换成MIN()效果相同</li>
</ul>
</li>
</ul>
<h4 id="案例-行子查询"><a href="#案例-行子查询" class="headerlink" title="案例 - 行子查询"></a>案例 - 行子查询</h4><ul>
<li>旧版本：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 员工编号最小并且工资最高的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(employee_id)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">) <span class="keyword">AND</span> <span class="keyword">WHERE</span> salary = (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>用行子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (employ_id,salary)=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(employ_id),<span class="keyword">MAX</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h3><h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门的员工个数</span></span><br><span class="line"><span class="keyword">SELECT</span> d.*,(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*)</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	 <span class="keyword">WHERE</span> e.department_id = d.<span class="string">`department_id`</span></span><br><span class="line">) 个数</span><br><span class="line"><span class="keyword">FROM</span> departments d;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工号等于102的部门名</span></span><br><span class="line"><span class="keyword">SELECT</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_name</span><br><span class="line">	<span class="keyword">FROM</span> departments d</span><br><span class="line">	<span class="keyword">WHERE</span> d.department_id = e.department_id </span><br><span class="line">) 部门名</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.employee_id = <span class="number">102</span></span><br></pre></td></tr></table></figure>

<h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><ul>
<li>结果集，几行几列都可以</li>
</ul>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门平均工资的工资等级</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">FROM</span> job_grades;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ag_dep.*,g.grade_level</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">)ag_dep</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> ag_dep.ag <span class="keyword">BETWEEN</span> lowest_sal <span class="keyword">AND</span> highest_sal</span><br></pre></td></tr></table></figure>

<h3 id="EXISTS"><a href="#EXISTS" class="headerlink" title="EXISTS"></a>EXISTS</h3><ul>
<li>相关子查询,返回一个布尔类型，存在或者不存在</li>
</ul>
<h4 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询有员工的部门名</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> *</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span> <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询和Zlotkey相同部门的员工姓名和工资</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">from</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department_id =(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name = <span class="string">'Zlotkey'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资比公司平均工资高的员工的员工号</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary &gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询各部门的工资比本部门平均工资高的员工的姓名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>( salary) ag,department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) ag_dep</span><br><span class="line"><span class="keyword">ON</span> ag_dep.department_id = e.department_id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary&gt;ag_dep.ag</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询和姓名中包含u的员工在相同部门的员工的员工号和姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span>(<span class="string">'%u%'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询在部门的location_id为1700的部门工作的员工的员工号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> departments</span><br><span class="line">	<span class="keyword">WHERE</span> location_id = <span class="number">1700</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询管理者为K_ing的员工姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> employee_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name = <span class="string">'K_ing'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最低的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary = (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资最低的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> d.*</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.department_id = (</span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">ASC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资最低的部门信息和平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> d.*,<span class="keyword">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.department_id = e. department_id</span><br><span class="line"><span class="keyword">WHERE</span> d.department_id = (</span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">ASC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.department_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> d.*,ag_dep.ag</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">ASC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>) ag_dep</span><br><span class="line"><span class="keyword">ON</span> d.department_id = ag_dep. department_id</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询公司中所有manager的信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询各个部门最高工资中的最低工资的部门和工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary), department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">MAX</span>(salary) <span class="keyword">ASC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资最高的部门的manager的详细信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.employee_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> d.manager_id</span><br><span class="line">	<span class="keyword">FROM</span> departments d</span><br><span class="line">	<span class="keyword">WHERE</span> d.department_id = (</span><br><span class="line">		<span class="keyword">SELECT</span> department_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">MAX</span>(salary) <span class="keyword">DESC</span></span><br><span class="line">		<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>购物网页在一页内无法全部显示时，需要分页显示。只查询能显示的数据。自动分部提交每一页的请求。</li>
</ul>
<h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><ul>
<li><strong>索引从0开始</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 规则</span></span><br><span class="line"><span class="comment">-- LIMIT offset,size;</span></span><br><span class="line"><span class="comment">-- size:显示的条目个数</span></span><br><span class="line"><span class="comment">-- offset 查询的条目起始索引，从0开始</span></span><br></pre></td></tr></table></figure>

<h3 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询前五条员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有奖金的员工信息，并且工资较高的10位显示出来</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>查询语句的执行先后顺序</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 每一步生成一个虚拟表,第七步之后表的内容不在变换</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">7</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="number">1</span> 	</span><br><span class="line"><span class="keyword">JOIN</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ON</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">4</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">HAVING</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">8</span> </span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>

<h2 id="union联合查询"><a href="#union联合查询" class="headerlink" title="union联合查询"></a>union联合查询</h2><ul>
<li><p>将多条查询语句的结果合并成一个结果.查询的信息需要相同。</p>
</li>
<li><p>要求多个语句的查询列数一致</p>
</li>
<li><p>多个语句每一列的数据类型一致</p>
</li>
<li><p>union会自动去掉重复项如果不需要去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id&gt;<span class="number">90</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="案例-6"><a href="#案例-6" class="headerlink" title="案例"></a>案例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询部门编号大于90或者邮箱中包含a的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span> <span class="keyword">OR</span> department_id&gt;<span class="number">90</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id&gt;<span class="number">90</span></span><br></pre></td></tr></table></figure>

<h1 id="第三章-DML语言"><a href="#第三章-DML语言" class="headerlink" title="第三章 DML语言"></a>第三章 DML语言</h1><ul>
<li>数据操作语言</li>
</ul>
<h2 id="插入语句"><a href="#插入语句" class="headerlink" title="插入语句"></a>插入语句</h2><h3 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 （列名，...）</span><br><span class="line"><span class="keyword">values</span> (值<span class="number">1</span>，值<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入值得类型需要和列的类型一直一致</span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以为null的列是如何插入值的</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 （列名<span class="number">1</span>,列名<span class="number">2</span>）</span><br><span class="line"><span class="keyword">values</span> (<span class="literal">NULL</span>，值<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 （列名<span class="number">2</span>）</span><br><span class="line"><span class="keyword">values</span> (值<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>列的顺序是否可以调换<ul>
<li>只要和数据对应就可以。</li>
</ul>
</li>
<li>列数和值的个数需要一致</li>
<li>可以省略列名<ul>
<li>默认所有列的默认顺序。</li>
</ul>
</li>
</ul>
<h3 id="方式2"><a href="#方式2" class="headerlink" title="方式2"></a>方式2</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名</span><br><span class="line"><span class="keyword">set</span> 列名=值,列名=值...</span><br></pre></td></tr></table></figure>

<ul>
<li>案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">id</span>=<span class="number">19</span>,<span class="keyword">NAME</span>=<span class="string">'刘涛'</span>,phone=<span class="string">'999'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="两种方式比较"><a href="#两种方式比较" class="headerlink" title="两种方式比较"></a>两种方式比较</h3><ul>
<li><p>方式1</p>
<ul>
<li>支持插入多行数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 （列名<span class="number">1</span>,列名<span class="number">2</span>）</span><br><span class="line"><span class="keyword">values</span> (<span class="literal">NULL</span>，值<span class="number">2</span>)</span><br><span class="line">,(<span class="literal">NULL</span>，值<span class="number">2</span>)</span><br><span class="line">,(<span class="literal">NULL</span>，值<span class="number">2</span>)</span><br><span class="line">,(<span class="literal">NULL</span>，值<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>支持子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,phone)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">26</span>,<span class="string">'宋茜'</span>,<span class="string">'11809866'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方式2</p>
<ul>
<li>不支持插入多行</li>
</ul>
</li>
</ul>
<h2 id="修改语句"><a href="#修改语句" class="headerlink" title="修改语句"></a>修改语句</h2><h3 id="修改单表的记录"><a href="#修改单表的记录" class="headerlink" title="修改单表的记录"></a>修改单表的记录</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名</span><br><span class="line"><span class="keyword">SET</span> 列=新值</span><br><span class="line"><span class="keyword">WHERE</span> 筛选条件;</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改beauty表中唐姓女士的电话为222</span></span><br><span class="line"><span class="keyword">UPDATE</span> beauty <span class="keyword">SET</span> phone = <span class="string">'222'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NAME</span> <span class="keyword">LIKE</span> <span class="string">'唐%'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="修改多表的记录"><a href="#修改多表的记录" class="headerlink" title="修改多表的记录"></a>修改多表的记录</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- sql92</span></span><br><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span>，表<span class="number">2</span></span><br><span class="line"><span class="keyword">SET</span> 列=新值</span><br><span class="line"><span class="keyword">WHERE</span> 连接条件</span><br><span class="line"><span class="keyword">AND</span> 筛选条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- sql99</span></span><br><span class="line"><span class="keyword">UPDATE</span> 表<span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表<span class="number">2</span></span><br><span class="line"><span class="keyword">ON</span> 连接条件</span><br><span class="line"><span class="keyword">SET</span> 列=新值</span><br><span class="line"><span class="keyword">WHERE</span> 筛选条件</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改张无忌女朋友的手机号为'114'</span></span><br><span class="line"><span class="keyword">UPDATE</span> beauty b</span><br><span class="line"><span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.boyfriend_id = bo.id</span><br><span class="line"><span class="keyword">SET</span> b.phone=<span class="string">'114'</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.boyName=<span class="string">'张无忌'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改没有男朋友的女生的男朋友都改为张飞</span></span><br><span class="line"><span class="keyword">UPDATE</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.boyfriend_id = bo.id</span><br><span class="line"><span class="keyword">SET</span> b.boyfriend_id=<span class="string">'张飞'</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.boyName=<span class="literal">null</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="删除语句"><a href="#删除语句" class="headerlink" title="删除语句"></a>删除语句</h2><h3 id="方式1-1"><a href="#方式1-1" class="headerlink" title="方式1"></a>方式1</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 筛选条件</span><br><span class="line"><span class="comment">-- 方式2</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除手机号以9结尾的信息</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> beauty <span class="keyword">WHERE</span> phone <span class="keyword">LIKE</span> <span class="string">'%9'</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="多表删除"><a href="#多表删除" class="headerlink" title="多表删除"></a>多表删除</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- sql92</span></span><br><span class="line"><span class="keyword">DELETE</span> 表<span class="number">1</span>别名，表<span class="number">2</span>别名</span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span>,表<span class="number">2</span></span><br><span class="line"><span class="keyword">WHERE</span> 连接条件</span><br><span class="line"><span class="keyword">AND</span> 筛选条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- sql99</span></span><br><span class="line"><span class="keyword">DELETE</span> 表<span class="number">1</span>别名,表<span class="number">2</span>别名</span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span>,别名</span><br><span class="line"><span class="keyword">JOIN</span> 表<span class="number">2</span>,别名</span><br><span class="line"><span class="keyword">ON</span> 筛选条件</span><br><span class="line"><span class="keyword">WHERE</span> 连接条件</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除张无忌女朋友的别名</span></span><br><span class="line"><span class="keyword">DELETE</span> b</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.boyfriend_id=bo.id</span><br><span class="line"><span class="keyword">WHERE</span> b.boyfriend_id=<span class="string">'张无忌'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除黄晓明的信息以及她女朋友的信息</span></span><br><span class="line"><span class="keyword">DELETE</span> b,bo</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.boyfriend_id=bo.id</span><br><span class="line"><span class="keyword">WHERE</span> b.boyfriend_id=<span class="string">'黄晓明'</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="方式2-1"><a href="#方式2-1" class="headerlink" title="方式2"></a>方式2</h3><ul>
<li><p>清空表中全部数据</p>
</li>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- truncate</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> boys;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="两种方式的区别"><a href="#两种方式的区别" class="headerlink" title="两种方式的区别"></a>两种方式的区别</h3><ul>
<li><p>delete</p>
<ul>
<li>可以选择删除</li>
<li>删除后插入数据自增长值从断点开始</li>
<li>删除有返回值，可以返回受影响的行数</li>
<li>可以回滚</li>
</ul>
</li>
<li><p>truncate</p>
<ul>
<li>只能全部清空</li>
<li>效率略高</li>
<li>删除后插入数据自增长值从1开始</li>
<li>删除没有返回值，不返回行数</li>
<li>不能回滚</li>
</ul>
</li>
<li><p>查看表的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC 表名;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="第四章-DDL语言"><a href="#第四章-DDL语言" class="headerlink" title="第四章 DDL语言"></a>第四章 DDL语言</h1><ul>
<li>库的管理<ul>
<li>创建 create</li>
<li>修改 alter</li>
<li>删除 drop</li>
</ul>
</li>
<li>表的管理<ul>
<li>创建</li>
<li>修改</li>
<li>删除</li>
</ul>
</li>
</ul>
<h2 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 库名;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><ul>
<li><p>一般来说不允许修改</p>
</li>
<li><p>修改库名没有单独sql语句，需要直接修改文件名</p>
</li>
<li><p>可以更改库的字符集</p>
<ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> books <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> gbk;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="库删除"><a href="#库删除" class="headerlink" title="库删除"></a>库删除</h3><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> books;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`book`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`bName`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`price`</span> <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`authorID`</span> <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`publishDate`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line">DESC book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> author(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	au_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	NATION <span class="built_in">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DESC author;</span><br></pre></td></tr></table></figure>

<h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改列名</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">CHANGE</span> <span class="keyword">COLUMN</span> publishdate pubDate DATETIME</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列的类型或者约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> pubDate <span class="built_in">TIMESTAMP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加新列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> aunnel <span class="built_in">INT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> aunnel</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">RENAME</span> <span class="keyword">TO</span> book_author</span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> book_author;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure>

<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_author <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>,<span class="string">'村上春树1'</span>,<span class="string">'日本1'</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">'村上春树2'</span>,<span class="string">'日本2'</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">'村上春树3'</span>,<span class="string">'日本3'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复制表的结构</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy <span class="keyword">LIKE</span> book_author</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复制表的结构+数据</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy2</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> book_author</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只复制部分</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy3</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,au_name <span class="keyword">FROM</span> book_author</span><br><span class="line"><span class="keyword">WHERE</span> nation=<span class="string">'日本2'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只复制某些字段，不要数据</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy4</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,au_name <span class="keyword">FROM</span> book_author</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h2><ul>
<li><p>代表限制表中的数据，为了保证表的数据的准确和可靠性</p>
</li>
<li><p>一共六大约束</p>
<ul>
<li>NOT NULL：非空约束，学号等。</li>
<li>DEFAULT:保证该字段有默认值。类似性别：大部分人是男生就默认为男生。</li>
<li>PRIMARY KEY：唯一非空</li>
<li>UNIQUE:唯一约束，可以为空</li>
<li>CHECK:检查约束，mysql不支持。</li>
<li>FOREIGN KEY:限制两个表的关系，保证该表的字段值必须来自于主表的关联列的值。</li>
</ul>
</li>
<li><p>添加约束的时机：</p>
<ul>
<li>创建表时</li>
<li>修改表时</li>
</ul>
</li>
<li><p>约束的添加分类</p>
<ul>
<li>列级约束<ul>
<li>六大约束语法都支持，但外键约束没有效果<strong>,不支持起名。</strong></li>
</ul>
</li>
<li>表级约束<ul>
<li>除了非空，默认。其他都支持。<strong>支持起名，主键起名也无效果。</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="创建表时添加约束"><a href="#创建表时添加约束" class="headerlink" title="创建表时添加约束"></a>创建表时添加约束</h3><h4 id="添加列级约束"><a href="#添加列级约束" class="headerlink" title="添加列级约束"></a>添加列级约束</h4><ul>
<li><p>不支持外键</p>
</li>
<li><p>添加多个列级约束用空格隔开就可以</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuName VARCHAR(20) NOT NULL UNIQUE;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> students;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> students</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>) <span class="keyword">CHECK</span>(gender=<span class="string">'男'</span> <span class="keyword">OR</span> gender=<span class="string">'女'</span>),</span><br><span class="line">	seat <span class="built_in">INT</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">	age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span>,</span><br><span class="line">	mahorID <span class="built_in">INT</span> <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> major(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	majorName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> stuinfo;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> major;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

<h4 id="添加表级约束"><a href="#添加表级约束" class="headerlink" title="添加表级约束"></a>添加表级约束</h4><ul>
<li><p>不支持非空，默认</p>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 表级约束</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> stuinfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	seat <span class="built_in">INT</span> ,</span><br><span class="line">	age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span>,</span><br><span class="line">	majorID <span class="built_in">INT</span>,</span><br><span class="line"></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> pk PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>),</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> uq <span class="keyword">UNIQUE</span>(seat),</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> ck <span class="keyword">CHECK</span>(gender=<span class="string">'男'</span> <span class="keyword">OR</span> gender=<span class="string">'女'</span>),</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> fk_stuinfo_major <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorID) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="常用写法"><a href="#常用写法" class="headerlink" title="常用写法"></a>常用写法</h4><ul>
<li>一般除了外键都会在列级添加</li>
</ul>
<h4 id="主键和唯一约束的对比"><a href="#主键和唯一约束的对比" class="headerlink" title="主键和唯一约束的对比"></a>主键和唯一约束的对比</h4><ul>
<li><p>主键</p>
<ul>
<li><p>可以保证唯一性</p>
</li>
<li><p>不允许为空</p>
</li>
<li><p>一个表中最多有一个</p>
</li>
<li><p>可以将两个列视为一个主键，不推荐</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONSTRAINT pk PRIMARY KEY(id,stuname)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>唯一</p>
<ul>
<li>可以保证唯一性</li>
<li>可以为空，<strong>空值出现超过一个也视为重复</strong></li>
<li>不限制数量</li>
<li>可以组合，不推荐</li>
</ul>
</li>
</ul>
<h4 id="主键和外键的对比"><a href="#主键和外键的对比" class="headerlink" title="主键和外键的对比"></a>主键和外键的对比</h4><ul>
<li>主键</li>
<li>外键<ul>
<li>要求在从表中设置</li>
<li>和主表中字段属性一致</li>
<li>插入数据时，应该先插入主表再插入从表</li>
<li>删除数据，先删除从表，在删除主表</li>
<li>一般是主键</li>
</ul>
</li>
</ul>
<h3 id="修改表时添加约束"><a href="#修改表时添加约束" class="headerlink" title="修改表时添加约束"></a>修改表时添加约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改表时添加约束</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> stuinfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	seat <span class="built_in">INT</span> ,</span><br><span class="line">	age <span class="built_in">INT</span> ,</span><br><span class="line">	majorID <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> stuinfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">-- 主键列级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"><span class="comment">-- 主键表级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 外键表级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_stuinfo_major <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorID) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

<h3 id="修改表时删除约束"><a href="#修改表时删除约束" class="headerlink" title="修改表时删除约束"></a>修改表时删除约束</h3><ul>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除非空约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> age <span class="built_in">INT</span>;</span><br><span class="line"><span class="comment">-- 删除默认约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> age <span class="built_in">INT</span>;</span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"><span class="comment">-- 删除唯一约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> <span class="keyword">INDEX</span> seat;</span><br><span class="line"><span class="comment">-- 删除外键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> fk_stuinfo_major;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="标识列"><a href="#标识列" class="headerlink" title="标识列"></a>标识列</h3><ul>
<li><p>又称为<strong>自增长列</strong></p>
<ul>
<li>不用手动的插入列，系统提供默认的序列值</li>
</ul>
</li>
<li><p>标识列不一定必须和<strong>主键</strong>搭配。也可以和<strong>外键</strong>，<strong>唯一</strong>搭配。</p>
</li>
<li><p>自增长列<strong>最多只有一个</strong>。且类型只可以是INT，float，double等<strong>数值型。</strong></p>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时设置标识列</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> tab_identity;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_identity(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">	<span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_identity <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'join'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_identity(<span class="keyword">NAME</span>) <span class="keyword">VALUES</span>(<span class="string">'join'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_identity;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不从1开始增长</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%auto_increment%'</span>;</span><br><span class="line"><span class="comment">-- 更改每次增长3</span></span><br><span class="line"><span class="keyword">SET</span> auto_increment_increment=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以通过手动插入值设置初始值</span></span><br><span class="line"><span class="comment">-- 将第一个值手动插入为目标值</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>案例2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改表时设置标识列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tab_identity <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表时删除标识列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tab_identity <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span> <span class="built_in">INT</span>;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="第五章-数据类型"><a href="#第五章-数据类型" class="headerlink" title="第五章 数据类型"></a>第五章 数据类型</h1><ul>
<li>数值型<ul>
<li>整型</li>
<li>小数<ul>
<li>定点数</li>
<li>浮点数</li>
</ul>
</li>
</ul>
</li>
<li>字符型<ul>
<li>较短的文本<ul>
<li>char，varchar</li>
</ul>
</li>
<li>较长的文本<ul>
<li>text,blob(图片，较长的二进制文件)</li>
</ul>
</li>
</ul>
</li>
<li>日期型</li>
</ul>
<h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200716113751512.png" alt="image-20200716113751512"></p>
<ul>
<li><p>Tinyint：8位</p>
</li>
<li><p>Smallint：16位</p>
</li>
<li><p>无符号和有符号整型测试</p>
<ul>
<li>如果不设置无符号还是有符号，默认有符号</li>
<li>如果不设置长度，会有默认的长度<ul>
<li>int 有符号默认11</li>
<li>int 无符号默认10</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无符号和有符号整型</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_int(</span><br><span class="line">	t1 <span class="built_in">INT</span></span><br><span class="line">);</span><br><span class="line">DESC tab_int</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_int <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">-123456</span>,<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_int</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> tab_int</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 无符号UNSIGNED</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_int(</span><br><span class="line">	t1 <span class="built_in">INT</span>,</span><br><span class="line">	t2 <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>整型的长度代表的是什么</p>
<ul>
<li>代表显示结果的宽度</li>
</ul>
</li>
<li><p>ZEROFILL,默认是有符号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ZEROFILL</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_int2(</span><br><span class="line">	t1 <span class="built_in">INT</span> ZEROFILL,</span><br><span class="line">	t2 <span class="built_in">INT</span> ZEROFILL</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="小数"><a href="#小数" class="headerlink" title="小数"></a>小数</h2><p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200716115344244.png" alt="image-20200716115344244"></p>
<h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><ul>
<li>float(M,D)</li>
<li>double(M,D)</li>
</ul>
<h3 id="定点型"><a href="#定点型" class="headerlink" title="定点型"></a>定点型</h3><ul>
<li><p>dec(M,D)</p>
</li>
<li><p>decimal(M,D)</p>
</li>
<li><p>M：总共的位数，整数部位+小数部位</p>
</li>
<li><p>D：小数点后保留的位数 小数部位</p>
</li>
<li><p>M和D都可以省略，float和double默认不规定精度，随着数值的范围规定。decimal默认为M默认10，D默认0.</p>
</li>
</ul>
<h4 id="定点和浮点比较"><a href="#定点和浮点比较" class="headerlink" title="定点和浮点比较"></a>定点和浮点比较</h4><ul>
<li><p>要求插入数值精度高（货币运算）：定点</p>
</li>
<li><p>原则：类型越简单越好，能保存的类型越小越好。</p>
</li>
</ul>
<h2 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h2><ul>
<li><p>较短的文本</p>
<ul>
<li>char：固定长度字符，耗费空间，效率高</li>
<li>varchar：变长字符，节省空间，效率低</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 字符枚举型字段</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_char(</span><br><span class="line">	c1 ENUM(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_char <span class="keyword">VALUES</span>(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_char <span class="keyword">VALUES</span>(<span class="string">'b'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_char <span class="keyword">VALUES</span>(<span class="string">'c'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_char <span class="keyword">VALUES</span>(<span class="string">'m'</span>);<span class="comment">-- 插入失败</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_char <span class="keyword">VALUES</span>(<span class="string">'A'</span>);<span class="comment">-- 插入a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_char;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SET 可以插入多个值</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_set(</span><br><span class="line">	s1 <span class="keyword">SET</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_set <span class="keyword">VALUES</span>(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_set <span class="keyword">VALUES</span>(<span class="string">'a,b'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_set <span class="keyword">VALUES</span>(<span class="string">'a,c,d'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_set</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200716162820695.png" alt="image-20200716162820695"></p>
<ul>
<li>较长的文本<ul>
<li>text</li>
<li>blob(较大的二进制)</li>
</ul>
</li>
</ul>
<h2 id="日期型"><a href="#日期型" class="headerlink" title="日期型"></a>日期型</h2><p><img src="/111zx/111zx.github.io/2020/05/20/Mysql/C:%5CUsers%5C14914%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200716165853627.png" alt="image-20200716165853627"></p>
<ul>
<li>timestamp受实际的时区有关,范围是1970-2038年，DATETIME是1000-9999年</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 时间类型</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_date(</span><br><span class="line">	t1 DATETIME,</span><br><span class="line">	t2 <span class="built_in">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_date <span class="keyword">VALUES</span>(<span class="keyword">NOW</span>(),<span class="keyword">NOW</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'time_zone'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">time_zone</span>=<span class="string">'+8:00'</span></span><br></pre></td></tr></table></figure>

<h1 id="第六章-事务"><a href="#第六章-事务" class="headerlink" title="第六章 事务"></a>第六章 事务</h1><ul>
<li><p>事务：一个或者一组sql语句组成的一个执行单元，这个执行单元要么全部执行，要么全部不执行。如果其中某一条语句执行失败，则整个执行单元会回滚到单元开始。</p>
</li>
<li><p>存储引擎：在mysql中不同的存储技术。</p>
<ul>
<li><pre><code class="sql"><span class="keyword">SHOW</span> <span class="keyword">ENGINES</span>;<span class="comment">-- 查看mysql中的存储引擎</span>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - innodb支持事务，myisam，memory不支持事务。</span><br><span class="line"></span><br><span class="line">- ACID</span><br><span class="line"></span><br><span class="line">  - 原子性(Atomicty)</span><br><span class="line"></span><br><span class="line">    原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</span><br><span class="line"></span><br><span class="line">  - 一致性(Consistency)</span><br><span class="line"></span><br><span class="line">    事务必须使数据库从一个一致性状态变换到另一个一致性状态。</span><br><span class="line"></span><br><span class="line">    例如：转账前后两个账户金额总额不变</span><br><span class="line"></span><br><span class="line">  - 隔离性(Isolation)</span><br><span class="line"></span><br><span class="line">    事物的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</span><br><span class="line"></span><br><span class="line">  - 持久性(Durability)</span><br><span class="line"></span><br><span class="line">    一个事务一旦被提交，他对数据库的改变是永久性的，接下来的其他操作和数据库故障不会对其有任何影响。</span><br><span class="line"></span><br><span class="line">## 事务的创建</span><br><span class="line"></span><br><span class="line">- 隐式事务</span><br><span class="line"></span><br><span class="line">  没有明显的开启和结束的标记，例如：insert,update,delete语句</span><br><span class="line"></span><br><span class="line">- 显式事务</span><br><span class="line"></span><br><span class="line">  具有明显的开启和结束的标记，例如：insert,update,delete语句</span><br><span class="line"></span><br><span class="line">  必须先设置自动提交功能为禁用</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96;sql</span><br><span class="line">  -- 设置自动提交功能为禁用 每次使用时设置只有此次有效</span><br><span class="line">  SET autocommit&#x3D;0;</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
<li><p>使用步骤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 步骤1 开启事务</span></span><br><span class="line"><span class="keyword">set</span> autocommit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤2 编写事务中的sql语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤3 结束事务</span></span><br><span class="line"><span class="keyword">commit</span>;<span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">rollback</span>;<span class="comment">-- 回滚事务</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 步骤1 开启事务</span></span><br><span class="line"><span class="keyword">set</span> autocommit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤2 编写事务中的sql语句</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">account</span> <span class="keyword">SET</span> balance = <span class="number">500</span> <span class="keyword">WHERE</span> username=<span class="string">'tom'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">account</span> <span class="keyword">SET</span> balance = <span class="number">1500</span> <span class="keyword">WHERE</span> username=<span class="string">'rose'</span>;</span><br><span class="line"><span class="comment">-- 步骤3 结束事务,结束之前还没有在磁盘文件，只保存在内存</span></span><br><span class="line"><span class="keyword">commit</span>;<span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">rollback</span>;<span class="comment">-- 回滚事务</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h2><ul>
<li><p>对于同时运行的多个事务，当这些事务访问数据库中相同数据时，如果没有采取必要的隔离机制，就会导致各种并发问题。</p>
<ul>
<li><p>脏读：t1和t2两个事务，t1读取了t2未提交到磁盘但是保存在了内存的数据，这时t2事务回滚操作，读取的数据无效。</p>
</li>
<li><p>不可重复读：t1和t2两个事务，t1中有sql语句先读取了一个字段，这时t2更新了该字段，t1事务中有可能还会有sql语句再读取该字段，数据就不同了。</p>
</li>
<li><p>幻读：t1和t2两个事务，t1中有sql语句先读取了一个字段，这时t2在该字段插入了多行，t1事务中有可能还会有sql语句再读取该字段，数据会多出几行。</p>
</li>
</ul>
</li>
<li><p>可以设置数据的隔离级别来避免这些并发问题</p>
<ul>
<li>Oracle支持两种隔离级别<ul>
<li>READ COMMITED(默认)</li>
<li>SERIALIZABLE</li>
</ul>
</li>
<li>mysql有4种隔离级别<ul>
<li>REPEATABLE READ(默认)</li>
</ul>
</li>
</ul>
</li>
<li><p>设置<strong>当前连接</strong>隔离级别</p>
<p>没启动一个myql程序，就会获得一个单独的数据库连接，每个数据库连接都有一个全局变量@@tx_isolation，表示当前事务隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前连接的隔离级别</span></span><br><span class="line"><span class="keyword">select</span> @@tx_isolation</span><br><span class="line"><span class="comment">-- 设置当前连接的隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> committed;</span><br><span class="line"><span class="comment">-- 设置全局数据库的隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> committed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 隔离级别</span></span><br><span class="line">read uncommitted;<span class="comment">-- 都不可避免 </span></span><br><span class="line">read committed;<span class="comment">-- 可避免脏读</span></span><br><span class="line">repeatable read;<span class="comment">-- 可避免脏读，可重复读</span></span><br><span class="line">serializable;<span class="comment">-- 可避免脏读，可重复读以及幻读</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql默认是 repeatable read;</span></span><br><span class="line"><span class="comment">-- oracle默认是 read commited;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>回滚点 savepoint</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="comment">-- 设置回滚点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> a;</span><br><span class="line"><span class="keyword">UPDATE</span> stuinfo <span class="keyword">SET</span> majorID = <span class="number">700</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 步骤3 结束事务,结束之前还没有在磁盘文件，只保存在内存</span></span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> a;<span class="comment">-- 回滚事务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="delete和truncate在事务中的区别"><a href="#delete和truncate在事务中的区别" class="headerlink" title="delete和truncate在事务中的区别"></a>delete和truncate在事务中的区别</h2><ul>
<li><p>truncate不支持回滚，直接从磁盘中删除</p>
</li>
<li><p>delete支持回滚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 直接从磁盘中删除，不支持回滚</span></span><br><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="keyword">account</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="comment">-- 支持回滚</span></span><br><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">account</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="第七章-视图"><a href="#第七章-视图" class="headerlink" title="第七章 视图"></a>第七章 视图</h1><ul>
<li>视图是一个虚拟表，和普通表一样使用。是mysql15.1版本出现的新特性，是通过表动态生成的数据。只保存sql逻辑，不保存查询结果。<ul>
<li>临时</li>
<li>可重复利用</li>
<li>保护数据，提高安全性</li>
</ul>
</li>
<li>可以把经常使用的联合表设计成一个视图，以方便使用</li>
</ul>
<h2 id="视图的创建"><a href="#视图的创建" class="headerlink" title="视图的创建"></a>视图的创建</h2><ul>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询邮箱中包含a字符的员工名，部门名和工种信息</span></span><br><span class="line"><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myvl</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department_id = d.department_id</span><br><span class="line"><span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> j.job_id = e.job_id;</span><br><span class="line"><span class="comment">-- 使用视图</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myvl <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%a%'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询部门的平均工资级别</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> myvl2;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myvl2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myvl2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myvl2.ag,g.grade_level</span><br><span class="line"><span class="keyword">FROM</span> myvl2</span><br><span class="line"><span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> myvl2.ag <span class="keyword">BETWEEN</span> g.lowest_sal <span class="keyword">AND</span> g.highest_sal;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资最低的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myvl2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> ag <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="视图的修改"><a href="#视图的修改" class="headerlink" title="视图的修改"></a>视图的修改</h2><ul>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(( salary),job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br><span class="line">           </span><br><span class="line"><span class="comment">-- 方式2</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="视图的删除"><a href="#视图的删除" class="headerlink" title="视图的删除"></a>视图的删除</h2><ul>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> myvl,myvl2;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="查看视图结构"><a href="#查看视图结构" class="headerlink" title="查看视图结构"></a>查看视图结构</h2><ul>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myvl;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="更改视图中的数据"><a href="#更改视图中的数据" class="headerlink" title="更改视图中的数据"></a>更改视图中的数据</h2><ul>
<li><p><strong>不加权限的情况下更改视图数据会修改磁盘上表的数据。</strong></p>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,email</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myv1</span><br><span class="line"><span class="comment">-- 插入</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> myv1 <span class="keyword">VALUES</span>(<span class="string">'Tom'</span>,<span class="string">'1111@.com'</span>);</span><br><span class="line"><span class="comment">-- 修改</span></span><br><span class="line"><span class="keyword">UPDATE</span> myv1 <span class="keyword">SET</span> last_name=<span class="string">'张无忌'</span> <span class="keyword">WHERE</span> last_name=<span class="string">'Tom'</span>;</span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> myv1 <span class="keyword">WHERE</span> last_name = <span class="string">'张无忌'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>以下情况的视图是无法更新的</p>
<ul>
<li><p>包含以下sql语句</p>
<ul>
<li>分组函数</li>
<li>distinct</li>
<li>group by</li>
<li>having</li>
<li>union</li>
<li>union all</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) m,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br><span class="line"><span class="comment">-- 查询会出错 不能包括 group by</span></span><br><span class="line"><span class="keyword">UPDATE</span> myv1 <span class="keyword">SET</span> m=<span class="number">9000</span> <span class="keyword">WHERE</span> department_id=<span class="number">10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>常量视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 常量视图，编辑操作都不行</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'joni'</span> <span class="keyword">NAME</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>select中包含子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> (<span class="keyword">select</span> * <span class="keyword">from</span> employees) temp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>join或者链接语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不能更新</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">from</span> employees e</span><br><span class="line"><span class="keyword">join</span> departments d</span><br><span class="line"><span class="keyword">on</span> e.department_id=d.department_id</span><br></pre></td></tr></table></figure>
</li>
<li><p>from一个不可以更新的视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不能更新</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">from</span> myv3</span><br></pre></td></tr></table></figure>
</li>
<li><p>where子句的子查询引用了from子句中的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不能更新</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv4</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">select</span> last_name</span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> employee_id <span class="keyword">in</span>(</span><br><span class="line">	<span class="keyword">select</span> manager_id</span><br><span class="line">    <span class="keyword">from</span> employees</span><br><span class="line">    <span class="keyword">where</span> manager_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="视图和表的对比"><a href="#视图和表的对比" class="headerlink" title="视图和表的对比"></a>视图和表的对比</h2><ul>
<li>view<ul>
<li>不占用实际的物理空间（不保存数据，但是为视图的逻辑保存有物理空间）</li>
<li>可以增删改查，但是限制多</li>
</ul>
</li>
<li>table<ul>
<li>占用实际的物理空间来保存数据和逻辑。</li>
<li>可增删改</li>
</ul>
</li>
</ul>
<h1 id="第八章-变量"><a href="#第八章-变量" class="headerlink" title="第八章 变量"></a>第八章 变量</h1><ul>
<li><p>分类</p>
<ul>
<li><p>系统变量：由系统提供。</p>
<ul>
<li><p>全局变量：<strong>可以跨链接有效</strong>，对所有会话有效，但是不能跨服务器，服务器重新启动会初始化。</p>
<p>如果想改变服务器配置，需要修改配置文件。</p>
</li>
<li><p>会话变量：<strong>一次链接</strong></p>
</li>
</ul>
</li>
<li><p>自定义变量：自定义</p>
<ul>
<li>用户变量：类似于java自定义的全局变量</li>
<li>局部变量：类似于java自定义的局部变量</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><ul>
<li>由系统提供，属于服务器的层面，不由用户定义</li>
</ul>
<h3 id="使用语法"><a href="#使用语法" class="headerlink" title="使用语法"></a>使用语法</h3><h4 id="查看系统变量"><a href="#查看系统变量" class="headerlink" title="查看系统变量"></a>查看系统变量</h4><ul>
<li><p>查看所有系统变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看全局变量</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看会话变量</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">SESSION</span> <span class="keyword">VARIABLES</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>global是查看全局变量，省略或者session是会话变量。</strong></p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看满足条件的部分系统变量</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%char%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看指定某个系统变量的值</span></span><br><span class="line"><span class="keyword">SELECT</span> @@GLOBAL.系统变量名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为某个系统变量复制</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> 系统变量名 = 值;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @@GLOBAL.系统变量名 = 值;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h2><ul>
<li><p>用户自己定义，不由系统生成，可以用在任何地方，begin  end里面和外面都可以</p>
</li>
<li><p>步骤</p>
<ul>
<li><p>声明并初始化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @用户变量名=值;</span><br><span class="line"><span class="keyword">set</span> @用户变量名:=值;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">set</span> @用户变量名:=值;</span><br></pre></td></tr></table></figure>
</li>
<li><p>赋值,类型是弱类型，可以自动转换</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">set</span> @用户变量名=值;</span><br><span class="line"><span class="keyword">set</span> @用户变量名:=值;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">set</span> @用户变量名:=值;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2</span></span><br><span class="line"><span class="comment">--select 字段 into 变量名 from 表;</span></span><br><span class="line"><span class="comment">-- 把用户的人数赋值给count</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> @<span class="keyword">count</span></span><br><span class="line"><span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @变量名</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @a=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> @b=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> @c=@a+@b;</span><br><span class="line"><span class="keyword">select</span> @c;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h3><ul>
<li>作用域：针对于当前连接有效，和会话变量的作用域</li>
</ul>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><ul>
<li><p>作用域：仅仅在定义它的begin end中有效,且为第一句话。</p>
</li>
<li><p>步骤</p>
<ul>
<li><p>声明</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 类型;</span><br><span class="line"><span class="keyword">declare</span> 变量名 类型 <span class="keyword">default</span> 值;</span><br></pre></td></tr></table></figure>
</li>
<li><p>赋值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">set</span> 局部变量名=值;</span><br><span class="line"><span class="keyword">set</span> 局部变量名:=值;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">set</span> 局部变量名:=值;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2</span></span><br><span class="line"><span class="comment">--select 字段 into 变量名 from 表;</span></span><br><span class="line"><span class="comment">-- 把用户的人数赋值给count</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> @<span class="keyword">count</span></span><br><span class="line"><span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 变量名</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> m <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> n <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">SUM</span> <span class="built_in">INT</span>;</span><br><span class="line">	<span class="keyword">SET</span> <span class="keyword">SUM</span>=n+m;</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">SUM</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h1 id="第九章-存储过程和函数"><a href="#第九章-存储过程和函数" class="headerlink" title="第九章 存储过程和函数"></a>第九章 存储过程和函数</h1><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><ul>
<li>类似于java中的方法，一组预先编译好的sql语句的集合，理解成批处理语句</li>
<li>优点<ul>
<li>提高代码的重用性</li>
<li>简化操作</li>
<li>减少连接次数，如果没有存储过程或函数，每一条语句需要连接一次数据库，效率低下。</li>
<li>减少编译次数</li>
</ul>
</li>
</ul>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><h4 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h4><ul>
<li><p>注意：</p>
<ol>
<li>参数列表包含三部分</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in name varchar(20)</span><br></pre></td></tr></table></figure>

<ul>
<li>参数模式<ul>
<li>in:该参数可以作为输入，也就是该参数需要调用放传入值</li>
<li>out：该参数可以作为输出，也就是该参数可以作为返回值</li>
<li>inout：该参数可以作为输出和输入，也就是该参数需要调用放传入值或者作为返回值</li>
</ul>
</li>
<li>参数名</li>
<li>参数类型</li>
</ul>
<ol start="2">
<li><p>如果存储过程体仅仅只有一个sql语句，begin end可以省略</p>
<p>存储过程中的每一条sql语句的结尾要求必须加分号</p>
<p>存储过程的结尾可以使用delimiter重新设置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将$设置为结束标记</span></span><br><span class="line">DELIMITER $</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>语法</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(参数列表)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	</span><br><span class="line">	存储过程体（合法有效的<span class="keyword">sql</span>语句）</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 存储过程名(实参列表);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="案例-7"><a href="#案例-7" class="headerlink" title="案例"></a>案例</h3><ul>
<li><p>空参列表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入到admin表中的五条记录</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp1()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span></span><br><span class="line">	(<span class="string">'join'</span>,<span class="string">'0000'</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> myp1()$</span><br></pre></td></tr></table></figure>
</li>
<li><p>带in模式的参数的存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据女生名字查询对应的男生信息</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp2(<span class="keyword">IN</span> girlName <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.*</span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> bo.id = b.boyfriend_id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> myp2(<span class="string">'阿珍'</span>)$</span><br><span class="line"><span class="comment">-- 出现了字符集问题需要这种字符</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">names</span> gbk$</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户是否登陆成功</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp3(<span class="keyword">IN</span> userName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">IN</span> <span class="keyword">password</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">result</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> <span class="keyword">result</span></span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">admin</span></span><br><span class="line">	<span class="keyword">WHERE</span> username=userName</span><br><span class="line">	<span class="keyword">AND</span> <span class="keyword">password</span>=<span class="keyword">passWord</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="keyword">result</span>&gt;<span class="number">0</span>,<span class="string">'成功'</span>,<span class="string">'失败'</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> myp3(<span class="string">'阿珍'</span>,<span class="string">'8888'</span>)$</span><br></pre></td></tr></table></figure>
</li>
<li><p>带out模式的存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 带一个返回值的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据女生名返回对应的男生名</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp5(<span class="keyword">IN</span> girlName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> boyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.boyName <span class="keyword">INTO</span> boyName</span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> bo.id = b.boyfriend_id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">SET</span> @bName$</span><br><span class="line"><span class="keyword">CALL</span>(<span class="string">'小昭'</span>,@bName)$</span><br><span class="line"><span class="keyword">SELECT</span> @bName&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 带多个返回值的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据女生名返回对应的男生名和魅力值</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp6(<span class="keyword">IN</span> girlName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> boyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> userCP <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.boyName,bo.userCP <span class="keyword">INTO</span> boyName,userCP</span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> bo.id = b.boyfriend_id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span>(<span class="string">'小昭'</span>,@bName,@userCP)$</span><br><span class="line"><span class="keyword">SELECT</span> @bName,@userCP$</span><br></pre></td></tr></table></figure>
</li>
<li><p>inout模式参数的存储</p>
<p><strong>注意：需要定义变量，不能传入常量值。否则返回值没地方存储。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 传入a和b的值，要求a和b都翻倍并返回</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp8(INOUT a <span class="built_in">INT</span>,INOUT b <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> a=a*<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">SET</span> b=b*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">SET</span> @anum=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">SET</span> @bnum=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">CALL</span>(@anum,@bnum)$</span><br><span class="line"><span class="keyword">SELECT</span> @anum,@bnum$</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 实现传入用户名和密码，插入到admin表中</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_prol(<span class="keyword">IN</span> username <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">IN</span> loginPwd <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(admin.username,<span class="keyword">PASSWORD</span>)</span><br><span class="line">	<span class="keyword">VALUES</span>(username,loginpwd);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_prol(<span class="string">'admin'</span>,<span class="string">'100'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 传入一个日期，格式化为年月日并返回</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro2(<span class="keyword">IN</span> mydate DATETIME,<span class="keyword">OUT</span> strDate <span class="built_in">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(mydate,<span class="string">'%y年%m月%d日'</span>) <span class="keyword">INTO</span> strDate;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro2(<span class="keyword">now</span>(),@<span class="keyword">str</span>)$</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">str</span>$</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个存储过程,传入查询的条目数和起始索引，查询表的记录</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro3(<span class="keyword">IN</span> startindex <span class="built_in">INT</span>,<span class="keyword">IN</span> <span class="keyword">size</span> <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">LIMIT</span> startindex,<span class="keyword">size</span>; </span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro3(<span class="number">3</span>,<span class="number">5</span>)$ <span class="comment">-- 5条 从3开始</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="存储过程的删除"><a href="#存储过程的删除" class="headerlink" title="存储过程的删除"></a>存储过程的删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> test_prol;</span><br></pre></td></tr></table></figure>

<ul>
<li>每次只能删除一个存储过程。</li>
</ul>
<h3 id="查看存储过程的信息"><a href="#查看存储过程的信息" class="headerlink" title="查看存储过程的信息"></a>查看存储过程的信息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> test_prol;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul>
<li><p>和存储过程的区别：</p>
<p><strong>函数有且仅有一个返回值，适合处理数据返回一个结果。而存储过程可以有多个返回，适合做批量插入，批量跟新。</strong></p>
</li>
</ul>
<h3 id="创建as"><a href="#创建as" class="headerlink" title="创建as"></a>创建as</h3><ul>
<li><p>函数体一定会有返回值，如果没有会报错，不妨到最后也不会报错，单不建议</p>
</li>
<li><p>如果函数体只有一句话，则可以省略begin end</p>
</li>
<li><p>使用delimiter语句设置结束标记</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="comment">-- 参数列表包含 参数名 参数类型</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 函数名(参数列表) <span class="keyword">RETURNS</span> 返回类型</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	函数体</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="调用-1"><a href="#调用-1" class="headerlink" title="调用"></a>调用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行完函数的语句并且返回返回值</span></span><br><span class="line"><span class="keyword">SELECT</span> 函数名(参数列表)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>案例</p>
<p><strong>返回只能有一个，若返回多个结果，会出现错误</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 无参有返回</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf1() <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> c <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> c</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br><span class="line">	RETURN c;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myf1()$</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有参有返回</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf2(empName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> @sal=<span class="number">0</span>;<span class="comment">#定义用户变量</span></span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> last_name = empName;</span><br><span class="line">	RETURN @sal;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myf2(<span class="string">'k_ing'</span>)$</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="查看函数结构"><a href="#查看函数结构" class="headerlink" title="查看函数结构"></a>查看函数结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">function</span> myf1;</span><br></pre></td></tr></table></figure>

<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> myf1;</span><br></pre></td></tr></table></figure>

<h1 id="第十章-流程控制结构"><a href="#第十章-流程控制结构" class="headerlink" title="第十章 流程控制结构"></a>第十章 流程控制结构</h1><ul>
<li><p>分类</p>
<ul>
<li><p>顺序结构</p>
<p>程序从上往下依次执行</p>
</li>
<li><p>分支结构</p>
<p>从两条或者多条路径中选择一条去执行</p>
</li>
<li><p>循环结构</p>
<p>在满足一定条件的基础上，重复执行一段代码</p>
</li>
</ul>
</li>
</ul>
<h2 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h2><h3 id="if函数"><a href="#if函数" class="headerlink" title="if函数"></a>if函数</h3><ul>
<li>功能：实现简单的双分支</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(表达式<span class="number">1</span>,表达式<span class="number">2</span>,表达式<span class="number">3</span>)</span><br><span class="line"><span class="comment">-- 执行顺序：如果表达式1成立，返回表达式2，否则返回表达式3</span></span><br></pre></td></tr></table></figure>

<h3 id="case结构"><a href="#case结构" class="headerlink" title="case结构"></a>case结构</h3><ul>
<li><p>情况1</p>
<p>类似于switch语句，一般用于实现<strong>等值判断</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line">CASE 变量|表达式|字段</span><br><span class="line">WHEN 要判断的值 THEN 返回值1</span><br><span class="line">WHEN 要判断的值 THEN 返回值2</span><br><span class="line">ELSE 要返回的值n</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>情况2</p>
<p>类似于多重if语句，一般用于实现<strong>区间判断</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line">CASE </span><br><span class="line">WHEN 要判断的值 THEN 返回值1</span><br><span class="line">WHEN 要判断的值 THEN 返回值2</span><br><span class="line">ELSE 要返回的值n</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ul>
<li>可以作为表达式，嵌套在其它语句使用，可以放在任何地方，begin end内外都可</li>
<li>作为独立语句，只能在begin end中</li>
<li>执行时，如果WHEN中的值满足或者条件成立，则执行对应THEN后语句，并结束case；如果都不满足则执行else中的表达式，如果else省略，所有的case都不满足，则返回null。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 独立语句中</span></span><br><span class="line"><span class="comment">-- 根据传入的成绩，显示等级，传入的成绩：90-100 显示A 80-90 B 60-80 C 否则 D</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_case(<span class="keyword">IN</span> score <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> score &gt;= <span class="number">90</span> <span class="keyword">AND</span> score &lt;= <span class="number">100</span> <span class="keyword">THEN</span> <span class="keyword">SELECT</span> <span class="string">'A'</span>;</span><br><span class="line">	WHEN score &gt;= 80 THEN SELECT 'B';</span><br><span class="line">	WHEN score &gt;= 60 THEN SELECT 'C';</span><br><span class="line">	ELSE <span class="keyword">SELECT</span> <span class="string">'D'</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_case(<span class="number">52</span>)$</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="if-结构"><a href="#if-结构" class="headerlink" title="if 结构"></a>if 结构</h3><ul>
<li><p>功能：实现多重分支，在begin end中</p>
</li>
<li><p>案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> if 条件1 then 语句1;</span></span><br><span class="line"><span class="comment">else IF 条件1 then 语句1;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">[else 语句n]</span></span><br><span class="line"><span class="comment">end IF</span></span><br><span class="line"><span class="comment">在begin end中</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据根据传入的成绩，返回等级，传入的成绩：90-100 A 80-90 B 60-80 C 否则 D</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test_if(score <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">CHAR</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">IF</span> score&gt;=<span class="number">90</span> <span class="keyword">AND</span> score&lt;=<span class="number">100</span> <span class="keyword">THEN</span> <span class="keyword">RETURN</span> <span class="string">'A'</span>;</span><br><span class="line">	ELSEIF score&gt;=80 THEN RETURN 'B';</span><br><span class="line">	ELSEIF score&gt;=60 THEN RETURN 'C';</span><br><span class="line">	ELSE RETURN 'D';</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> test_if(<span class="number">65</span>)$</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><ul>
<li><p>分类</p>
<ul>
<li><p>while</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">【标签:】while 循环条件 do</span></span><br><span class="line"><span class="comment">	循环体;</span></span><br><span class="line"><span class="comment">end while 【标签】;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>loop</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- LOOP</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">【标签:】loop</span></span><br><span class="line"><span class="comment">	循环体;</span></span><br><span class="line"><span class="comment">end loop 【标签】;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>repeat</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">【标签:】repeat</span></span><br><span class="line"><span class="comment">	循环体;</span></span><br><span class="line"><span class="comment">until 结束循环的条件</span></span><br><span class="line"><span class="comment">end repeat 【标签】;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>循环控制</p>
<ul>
<li>iterate:类似于continue，结束本次循环继续下一次</li>
<li>leave:类似于break，结束循环并跳出</li>
</ul>
</li>
</ul>
<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据次数插入admin中多条记录</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_while1(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">'password'</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'Rose'</span>,i),<span class="string">'666'</span>);</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> pro_while1(<span class="number">100</span>) $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据次数插入admin中多条记录,入谷坡次数大于20，停止</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_while2(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	a:WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'Rose'</span>,i),<span class="string">'666'</span>);</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">		IF i&gt;=19 THEN LEAVE a;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span> a;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> pro_while2(<span class="number">100</span>) $</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据次数插入admin中多条记录,只插入偶数次</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_while2(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	a:WHILE i&lt;=insertCount DO</span><br><span class="line">		IF MOD(i,2)!=0 THEN ITERATE a;</span><br><span class="line">		<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'Rose'</span>,i),<span class="string">'666'</span>);</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span> a;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> pro_while2(<span class="number">100</span>) $</span><br></pre></td></tr></table></figure>

<ul>
<li>经典案例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">已知表stringcontent</span></span><br><span class="line"><span class="comment">id：自增长</span></span><br><span class="line"><span class="comment">content varchar(20)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">向该表插入指定个数的，随机字符串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> stringcontent;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stringcontent(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> auto_increment,</span><br><span class="line">	<span class="keyword">content</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_randstr_insert(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> ;</span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">str</span> <span class="built_in">VARCHAR</span>(<span class="number">26</span>) <span class="keyword">DEFAULT</span> <span class="string">'abcdefghijklmnopqrstuvwxyz'</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> startIndex <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">len</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">SET</span> <span class="keyword">len</span>=<span class="keyword">FLOOR</span>(<span class="keyword">RAND</span>()*(<span class="number">20</span>-startIndex+<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">SET</span> startIndex=<span class="keyword">FLOOR</span>(<span class="keyword">RAND</span>()*<span class="number">26</span>+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> stringcontent(<span class="keyword">content</span>) <span class="keyword">VALUES</span> (<span class="keyword">SUBSTR</span>(<span class="keyword">str</span>,startIndex,<span class="keyword">len</span>));</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/Mysql/" data-id="ckbbzdvrz0001t8ubexqba81i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Spring源码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/Spring%E6%BA%90%E7%A0%81/" class="article-date">
  <time datetime="2020-05-19T23:44:18.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/Spring%E6%BA%90%E7%A0%81/">Spring源码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/111zx/111zx.github.io/2020/05/20/Spring%E6%BA%90%E7%A0%81/" data-id="ckbbzdvs20002t8ub3e3v4iz7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/06/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E7%B3%BB%E7%BB%9F/">文件传输系统</a>
          </li>
        
          <li>
            <a href="/2020/07/05/1.%20%E7%82%B9%E5%87%BB%E6%96%87%E4%BB%B6%E6%A0%91%E6%98%BE%E7%A4%BA%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8/">1. 点击文件树显示文件列表</a>
          </li>
        
          <li>
            <a href="/2020/06/22/IO%E6%B5%81/">IO流</a>
          </li>
        
          <li>
            <a href="/2020/06/10/%E6%B3%9B%E5%9E%8B/">泛型</a>
          </li>
        
          <li>
            <a href="/2020/06/09/%E8%BD%AF%E4%BB%B6%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AF%BE%E7%A8%8B%E6%8A%A5%E5%91%8A/">软件体系结构课程报告</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 zx<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>